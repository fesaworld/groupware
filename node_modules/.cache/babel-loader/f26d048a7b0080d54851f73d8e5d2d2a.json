{"remainingRequest":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/babel-loader/lib/index.js!/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/eslint-loader/index.js??ref--14-0!/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/src/lib/axios.js","dependencies":[{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/src/lib/axios.js","mtime":1673491775268},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/cache-loader/dist/cjs.js","mtime":1673491971474},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/babel-loader/lib/index.js","mtime":1673491971758},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/eslint-loader/index.js","mtime":1673491969842}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCBfc2xpY2VkVG9BcnJheSBmcm9tICIvVXNlcnMvamRzL0RvY3VtZW50cy9kaXNrb21pbmZvL2pkcy9kaWdpdGVhbS9ncm91cHdhcmUvZ3JvdXB3YXJlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9zbGljZWRUb0FycmF5IjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiL1VzZXJzL2pkcy9Eb2N1bWVudHMvZGlza29taW5mby9qZHMvZGlnaXRlYW0vZ3JvdXB3YXJlL2dyb3Vwd2FyZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCB7IGdldEF4aW9zQ29uZmlnIH0gZnJvbSAnLi4vY29uZmlnJzsKaW1wb3J0IHsgZ2V0UmVmcmVzaFRva2VuRnJvbUNvb2tpZSwgc2V0UmVmcmVzaFRva2VuSW5Db29raWUsIHNldFRva2VuSW5Db29raWUgfSBmcm9tICcuL2pzLWNvb2tpZSc7CmV4cG9ydCB2YXIgR3JvdXB3YXJlQVBJID0gZnVuY3Rpb24gKCkgewogIHZhciBjb25maWcgPSBnZXRBeGlvc0NvbmZpZygpOwogIHJldHVybiBheGlvcy5jcmVhdGUoY29uZmlnKTsKfSgpOwpleHBvcnQgZnVuY3Rpb24gc2V0VG9rZW4odG9rZW4pIHsKICBpZiAodG9rZW4pIHsKICAgIEdyb3Vwd2FyZUFQSS5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnQXV0aG9yaXphdGlvbiddID0gIkJlYXJlciAiLmNvbmNhdCh0b2tlbik7CiAgfSBlbHNlIHsKICAgIGRlbGV0ZSBHcm91cHdhcmVBUEkuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ0F1dGhvcml6YXRpb24nXTsKICB9Cn0KZXhwb3J0IGZ1bmN0aW9uIGdldE5ld1Rva2VuKCkgewogIHJldHVybiBfZ2V0TmV3VG9rZW4uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZnVuY3Rpb24gX2dldE5ld1Rva2VuKCkgewogIF9nZXROZXdUb2tlbiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICB2YXIgb2xkUmVmcmVzaFRva2VuLCBfeWllbGQkR3JvdXB3YXJlQVBJJHAsIF95aWVsZCRHcm91cHdhcmVBUEkkcDIsIG5ld1JlZnJlc2hUb2tlbiwgbmV3QXV0aFRva2VuOwoKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gMDsKICAgICAgICAgICAgb2xkUmVmcmVzaFRva2VuID0gZ2V0UmVmcmVzaFRva2VuRnJvbUNvb2tpZSgpOwoKICAgICAgICAgICAgaWYgKG9sZFJlZnJlc2hUb2tlbikgewogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdubyByZWZyZXNoIHRva2VuIGluIGNvb2tpZScpOwoKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA2OwogICAgICAgICAgICByZXR1cm4gR3JvdXB3YXJlQVBJLnBvc3QoJ2F1dGgvcmVmcmVzaC8nLCB7CiAgICAgICAgICAgICAgcmVmcmVzaHRva2VuOiBvbGRSZWZyZXNoVG9rZW4KICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHJlcy5kYXRhOwogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChfcmVmMikgewogICAgICAgICAgICAgIHZhciBuZXdSZWZyZXNoVG9rZW4gPSBfcmVmMi5yZWZyZXNoX3Rva2VuLAogICAgICAgICAgICAgICAgICBuZXdBdXRoVG9rZW4gPSBfcmVmMi5hdXRoX3Rva2VuOwoKICAgICAgICAgICAgICBpZiAoIW5ld1JlZnJlc2hUb2tlbiB8fCAhbmV3QXV0aFRva2VuKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ25vIHJlZnJlc2ggdG9rZW4gZnJvbSBBUEknKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHNldFJlZnJlc2hUb2tlbkluQ29va2llKG5ld1JlZnJlc2hUb2tlbik7CiAgICAgICAgICAgICAgc2V0VG9rZW5JbkNvb2tpZShuZXdBdXRoVG9rZW4pOwogICAgICAgICAgICAgIHNldFRva2VuKG5ld0F1dGhUb2tlbik7CiAgICAgICAgICAgICAgcmV0dXJuIFtuZXdSZWZyZXNoVG9rZW4sIG5ld0F1dGhUb2tlbl07CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgX3lpZWxkJEdyb3Vwd2FyZUFQSSRwID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgIF95aWVsZCRHcm91cHdhcmVBUEkkcDIgPSBfc2xpY2VkVG9BcnJheShfeWllbGQkR3JvdXB3YXJlQVBJJHAsIDIpOwogICAgICAgICAgICBuZXdSZWZyZXNoVG9rZW4gPSBfeWllbGQkR3JvdXB3YXJlQVBJJHAyWzBdOwogICAgICAgICAgICBuZXdBdXRoVG9rZW4gPSBfeWllbGQkR3JvdXB3YXJlQVBJJHAyWzFdOwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgIHJlZnJlc2hUb2tlbjogbmV3UmVmcmVzaFRva2VuLAogICAgICAgICAgICAgIGF1dGhUb2tlbjogbmV3QXV0aFRva2VuCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gMTM7CiAgICAgICAgICAgIF9jb250ZXh0Mi50MCA9IF9jb250ZXh0MlsiY2F0Y2giXSgwKTsKICAgICAgICAgICAgc2V0UmVmcmVzaFRva2VuSW5Db29raWUobnVsbCk7CiAgICAgICAgICAgIHNldFRva2VuSW5Db29raWUobnVsbCk7CiAgICAgICAgICAgIHNldFRva2VuKG51bGwpOwogICAgICAgICAgICB0aHJvdyBfY29udGV4dDIudDA7CgogICAgICAgICAgY2FzZSAxOToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTIsIG51bGwsIFtbMCwgMTNdXSk7CiAgfSkpOwogIHJldHVybiBfZ2V0TmV3VG9rZW4uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZXhwb3J0IGZ1bmN0aW9uIHVzZVJlZnJlc2hUb2tlbkhvb2soX3JlZikgewogIHZhciBvblJlZnJlc2hTdWNjZXNzID0gX3JlZi5vblJlZnJlc2hTdWNjZXNzLAogICAgICBvblJlZnJlc2hGYWlsZWQgPSBfcmVmLm9uUmVmcmVzaEZhaWxlZDsKICBHcm91cHdhcmVBUEkuaW50ZXJjZXB0b3JzLnJlc3BvbnNlLnVzZShmdW5jdGlvbiBvblN1Y2Nlc3MocmVzKSB7CiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlcyk7CiAgfSwgLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgIHZhciBfb25FcnJvciA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShlcnJvcikgewogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgaWYgKCEoZXJyb3IgJiYgZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHNldFRva2VuKG51bGwpOwogICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAyOwogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA1OwogICAgICAgICAgICAgIHJldHVybiBnZXROZXdUb2tlbigpOwoKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGlmICghKHR5cGVvZiBvblJlZnJlc2hTdWNjZXNzID09PSAnZnVuY3Rpb24nKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDg7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA4OwogICAgICAgICAgICAgIHJldHVybiBvblJlZnJlc2hTdWNjZXNzKCk7CgogICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE1OwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMTA7CiAgICAgICAgICAgICAgX2NvbnRleHQudDAgPSBfY29udGV4dFsiY2F0Y2giXSgyKTsKCiAgICAgICAgICAgICAgaWYgKCEodHlwZW9mIG9uUmVmcmVzaEZhaWxlZCA9PT0gJ2Z1bmN0aW9uJykpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE1OwogICAgICAgICAgICAgIHJldHVybiBvblJlZnJlc2hGYWlsZWQoKTsKCiAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE4OwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBQcm9taXNlLnJlamVjdChlcnJvcikpOwoKICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZSwgbnVsbCwgW1syLCAxMF1dKTsKICAgIH0pKTsKCiAgICBmdW5jdGlvbiBvbkVycm9yKF94KSB7CiAgICAgIHJldHVybiBfb25FcnJvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfQoKICAgIHJldHVybiBvbkVycm9yOwogIH0oKSk7Cn0="},{"version":3,"sources":["/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/src/lib/axios.js"],"names":["axios","getAxiosConfig","getRefreshTokenFromCookie","setRefreshTokenInCookie","setTokenInCookie","GroupwareAPI","config","create","setToken","token","defaults","headers","common","getNewToken","oldRefreshToken","Error","post","refreshtoken","then","res","data","newRefreshToken","refresh_token","newAuthToken","auth_token","refreshToken","authToken","useRefreshTokenHook","onRefreshSuccess","onRefreshFailed","interceptors","response","use","onSuccess","Promise","resolve","error","status","reject","onError"],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport { getAxiosConfig } from '../config'\n\nimport {\n  getRefreshTokenFromCookie,\n  setRefreshTokenInCookie,\n  setTokenInCookie\n} from './js-cookie'\n\nexport const GroupwareAPI = (function () {\n  const config = getAxiosConfig()\n  return axios.create(config)\n})()\n\nexport function setToken (token) {\n  if (token) {\n    GroupwareAPI.defaults.headers.common['Authorization'] = `Bearer ${token}`\n  } else {\n    delete GroupwareAPI.defaults.headers.common['Authorization']\n  }\n}\n\nexport async function getNewToken () {\n  try {\n    const oldRefreshToken = getRefreshTokenFromCookie()\n    if (!oldRefreshToken) {\n      throw new Error('no refresh token in cookie')\n    }\n    const [newRefreshToken, newAuthToken] = await GroupwareAPI\n      .post('auth/refresh/', {\n        refreshtoken: oldRefreshToken\n      })\n      .then((res) => res.data)\n      .then(({ refresh_token: newRefreshToken, auth_token: newAuthToken }) => {\n        if (!newRefreshToken || !newAuthToken) {\n          throw new Error('no refresh token from API')\n        }\n        setRefreshTokenInCookie(newRefreshToken)\n        setTokenInCookie(newAuthToken)\n        setToken(newAuthToken)\n        return [newRefreshToken, newAuthToken]\n      })\n    return {\n      refreshToken: newRefreshToken,\n      authToken: newAuthToken\n    }\n  } catch (e) {\n    setRefreshTokenInCookie(null)\n    setTokenInCookie(null)\n    setToken(null)\n    throw e\n  }\n}\n\nexport function useRefreshTokenHook ({\n  onRefreshSuccess,\n  onRefreshFailed\n}) {\n  GroupwareAPI.interceptors.response.use(\n    function onSuccess (res) {\n      return Promise.resolve(res)\n    },\n    async function onError (error) {\n      if (error && error.response.status === 401) {\n        setToken(null)\n        try {\n          await getNewToken()\n          if (typeof onRefreshSuccess === 'function') {\n            await onRefreshSuccess()\n          }\n        } catch (e) {\n          if (typeof onRefreshFailed === 'function') {\n            await onRefreshFailed()\n          }\n        }\n      } else {\n        return Promise.reject(error)\n      }\n    }\n  )\n}\n"]}]}