{"remainingRequest":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/node_modules/babel-loader/lib/index.js!/Users/jds/Documents/diskominfo/jds/digiteam/groupware/node_modules/eslint-loader/index.js??ref--14-0!/Users/jds/Documents/diskominfo/jds/digiteam/groupware/src/api/index.js","dependencies":[{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/src/api/index.js","mtime":1673491775258},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/node_modules/cache-loader/dist/cjs.js","mtime":1673491971474},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/node_modules/babel-loader/lib/index.js","mtime":1673491971758},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/node_modules/eslint-loader/index.js","mtime":1673491969842}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubGFzdC1pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIjsKaW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL1VzZXJzL2pkcy9Eb2N1bWVudHMvZGlza29taW5mby9qZHMvZGlnaXRlYW0vZ3JvdXB3YXJlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyIjsKaW1wb3J0IF92YWx1ZXMgZnJvbSAnbG9kYXNoL3ZhbHVlcyc7CmltcG9ydCB7IGRiLCBzdG9yYWdlLCBUaW1lc3RhbXAgfSBmcm9tICdAL2xpYi9maXJlYmFzZSc7CmltcG9ydCB7IERPQ1VNRU5UX1RZUEUgfSBmcm9tICcuLi9jb21wb25lbnRzL1Byb2ZpbGUvRWRpdC91dGlscyc7Ci8qKgogKiAgQGVudW0ge3N0cmluZ30gLSBmaXJlYmFzZSBzdG9yYWdlIGZvbGRlcgoqLwoKZXhwb3J0IHZhciBTVE9SQUdFID0gewogIEVNUExPWUVFX0RPQ1VNRU5UUzogJ2VtcGxveWVlX2RvY3VtZW50cycKfTsKLyoqCiAqICBAZW51bSB7c3RyaW5nfSAtIGZpcmViYXNlIHN0b3JhZ2UgY29sbGVjdGlvbgoqLwoKZXhwb3J0IHZhciBDT0xMRUNUSU9OID0gewogIFVTRVJTOiAndXNlcnMnCn07IC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKLyoqCiAqIEJhc2ljIGhhbmRsZXIgd2hlbiB1c2VySWQgaXMgbm90IGRlZmluZWQgYXMgZnVuY3Rpb24gcGFyYW0KICogQHBhcmFtIHtzdHJpbmd9IGNhbGxlciAtIGZ1bmN0aW9uIG5hbWUKICogQHJldHVybnMge1Byb21pc2V9CiAqLwoKZnVuY3Rpb24gaGFuZGxlTm9Vc2VySWQoY2FsbGVyKSB7CiAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBSZWZlcmVuY2VFcnJvcigiIi5jb25jYXQoY2FsbGVyLCAiOiBpZCBtdXN0IGJlIHN1cHBsaWVkJyIpKSk7Cn0KLyoqCiAqIEdldCBzdG9yZWQgZmlsZSBtZXRhZGF0YQogKiBAcGFyYW0ge3N0cmluZ30gcHVibGljVVJMIC0gcHVibGljIFVSTCBvZiBzdG9yZWQgZmlsZSBpbiBGaXJlYmFzZSBTdG9yYWdlLCB0aGUgb25lIHRoYXQgc3RhcnRzIHdpdGggaHR0cHM6Ly8gaW5zdGVhZCBvZiBnczovLwogKiBAcmV0dXJucyB7UHJvbWlzZX0gYSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgbWV0YWRhdGEgaW4gdHlwZW9mIG9iamVjdAogKi8KCgpleHBvcnQgZnVuY3Rpb24gZ2V0U3RvcmVkRmlsZU1ldGFkYXRhKHB1YmxpY1VSTCkgewogIHJldHVybiBzdG9yYWdlLnJlZkZyb21VUkwocHVibGljVVJMKS5nZXRNZXRhZGF0YSgpOwp9Ci8qKgogKiBHZXQgdXNlciBhY2NvdW50IGRhdGEKICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBpZCAtIHVzZXIgaWQKICogQHJldHVybnMge29iamVjdHxudWxsfSB1c2VyIGRhdGEgaWYgZXhpc3RzCiAqLwoKZXhwb3J0IGZ1bmN0aW9uIGdldFVzZXJCeUlkKGlkKSB7CiAgaWYgKCFpZCkgcmV0dXJuIGhhbmRsZU5vVXNlcklkKCdnZXRVc2VyQnlJZCcpOwogIHJldHVybiBkYi5jb2xsZWN0aW9uKENPTExFQ1RJT04uVVNFUlMpLmRvYyhpZCkuZ2V0KCkudGhlbihmdW5jdGlvbiAoZG9jKSB7CiAgICBpZiAoZG9jLmV4aXN0cykgewogICAgICByZXR1cm4gZG9jLmRhdGEoKTsKICAgIH0KCiAgICByZXR1cm4gbnVsbDsKICB9KTsKfQovKioKICogSW5zZXJ0IG9yIHVwZGF0ZSB1c2VyIHByb2ZpbGUgZGV0YWlsCiAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn0gdXNlcklkCiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhCiAqIEByZXR1cm5zIHtQcm9taXNlfQogKi8KCmV4cG9ydCBmdW5jdGlvbiB1cHNlcnRVc2VyUHJvZmlsZURldGFpbCh1c2VySWQsIGRhdGEpIHsKICBpZiAoIXVzZXJJZCkgcmV0dXJuIGhhbmRsZU5vVXNlcklkKCJ1cGRhdGVVc2VyUGVyc29uYWxEYXRhIik7CiAgaWYgKCFkYXRhKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCdub29wJyk7CiAgcmV0dXJuIGRiLmNvbGxlY3Rpb24oQ09MTEVDVElPTi5VU0VSUykuZG9jKHVzZXJJZCkudXBkYXRlKF9vYmplY3RTcHJlYWQoewogICAgdXBkYXRlZF9hdDogVGltZXN0YW1wLm5vdygpCiAgfSwgZGF0YSkpOwp9Ci8qKgogKiBJbnNlcnQgb3IgdXBkYXRlIHVzZXIgZG9jdW1lbnQgdG8gZmlyZWJhc2Ugc3RvcmFnZQogKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ9IHVzZXJJZAogKiBAcGFyYW0ge3N0cmluZ30gZG9jdW1lbnRUeXBlCiAqIEBwYXJhbSB7RmlsZX0gZmlsZQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBvblByb2dyZXNzIC0gYSBmdW5jdGlvbiB0aGF0IHJlY2VpdmVzIChwcm9ncmVzczogbnVtYmVyLCBzbmFwc2hvdDogVXBsb2FkVGFzay5zbmFwc2hvdCkgYXMgYXJndW1lbnRzCiAqIEByZXR1cm5zIHtQcm9taXNlPn0gdGhlIHJlc29sdmVkIFVSTCBvZiBzdG9yZWQgZmlsZQogKi8KCmV4cG9ydCBmdW5jdGlvbiB1cHNlcnRVc2VyRG9jdW1lbnQodXNlcklkLCBkb2N1bWVudFR5cGUsIGZpbGUsIG9uUHJvZ3Jlc3MpIHsKICBpZiAoIXVzZXJJZCkgcmV0dXJuIGhhbmRsZU5vVXNlcklkKCd1cHNlcnRVc2VyRG9jdW1lbnQnKTsKICBpZiAoIWZpbGUpIHJldHVybiBQcm9taXNlLnJlc29sdmUoJ25vb3AnKTsKCiAgdmFyIGFsbG93ZWRUeXBlcyA9IF92YWx1ZXMoRE9DVU1FTlRfVFlQRSk7CgogIHZhciBzaG91bGRQcm9jZWVkID0gYWxsb3dlZFR5cGVzLmluY2x1ZGVzKGRvY3VtZW50VHlwZSk7CgogIGlmICghc2hvdWxkUHJvY2VlZCkgewogICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBSZWZlcmVuY2VFcnJvcigidXBzZXJ0VXNlckRvY3VtZW50OiBkb2N1bWVudCB0eXBlIG11c3QgYmUgb25lIG9mICIuY29uY2F0KGFsbG93ZWRUeXBlcy5qb2luKCcsICcpKSkpOwogIH0KCiAgdmFyIGV4dCA9IGZpbGUubmFtZS5zdWJzdHJpbmcoZmlsZS5uYW1lLmxhc3RJbmRleE9mKCcuJykgKyAxKTsKICB2YXIgc3RvcmFnZVJlZiA9IHN0b3JhZ2UucmVmKCkuY2hpbGQoIiIuY29uY2F0KFNUT1JBR0UuRU1QTE9ZRUVfRE9DVU1FTlRTLCAiLyIpLmNvbmNhdCh1c2VySWQsICIvIikuY29uY2F0KGRvY3VtZW50VHlwZSwgIi0iKS5jb25jYXQodXNlcklkLCAiLiIpLmNvbmNhdChleHQpKTsKICB2YXIgdXBsb2FkVGFzayA9IHN0b3JhZ2VSZWYucHV0KGZpbGUpOwoKICBpZiAodHlwZW9mIG9uUHJvZ3Jlc3MgPT09ICdmdW5jdGlvbicpIHsKICAgIHVwbG9hZFRhc2sub24oJ3N0YXRlX2NoYW5nZWQnLCBmdW5jdGlvbiAoc25hcHNob3QpIHsKICAgICAgdmFyIHByb2dyZXNzID0gTWF0aC5jZWlsKHNuYXBzaG90LmJ5dGVzVHJhbnNmZXJyZWQgLyBzbmFwc2hvdC50b3RhbEJ5dGVzICogMTAwKTsKICAgICAgb25Qcm9ncmVzcyhwcm9ncmVzcywgc25hcHNob3QpOwogICAgfSk7CiAgfQoKICByZXR1cm4gdXBsb2FkVGFzay50aGVuKGZ1bmN0aW9uIChzbmFwc2hvdCkgewogICAgcmV0dXJuIHNuYXBzaG90LnJlZi5nZXREb3dubG9hZFVSTCgpOwogIH0pOwp9CmV4cG9ydCBmdW5jdGlvbiBkZWxldGVVc2VyRG9jdW1lbnQodXNlcklkLCBmaWxlUHVibGljVVJMKSB7CiAgaWYgKCF1c2VySWQpIHJldHVybiBoYW5kbGVOb1VzZXJJZCgnZGVsZXRlVXNlckRvY3VtZW50Jyk7CiAgaWYgKCFmaWxlUHVibGljVVJMKSByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IFJlZmVyZW5jZUVycm9yKCdkZWxldGVVc2VyRG9jdW1lbnQ6IGZpbGVQdWJsaWNVUkwgbXVzdCBiZSBzdXBwbGllZCcpKTsKICB2YXIgc3RvcmFnZVJlZiA9IHN0b3JhZ2UucmVmRnJvbVVSTChmaWxlUHVibGljVVJMKTsKICByZXR1cm4gc3RvcmFnZVJlZi5kZWxldGUoKTsKfQ=="},{"version":3,"sources":["/Users/jds/Documents/diskominfo/jds/digiteam/groupware/src/api/index.js"],"names":["_values","db","storage","Timestamp","DOCUMENT_TYPE","STORAGE","EMPLOYEE_DOCUMENTS","COLLECTION","USERS","handleNoUserId","caller","Promise","reject","ReferenceError","getStoredFileMetadata","publicURL","refFromURL","getMetadata","getUserById","id","collection","doc","get","then","exists","data","upsertUserProfileDetail","userId","resolve","update","updated_at","now","upsertUserDocument","documentType","file","onProgress","allowedTypes","shouldProceed","includes","join","ext","name","substring","lastIndexOf","storageRef","ref","child","uploadTask","put","on","snapshot","progress","Math","ceil","bytesTransferred","totalBytes","getDownloadURL","deleteUserDocument","filePublicURL","delete"],"mappings":"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","sourcesContent":["import _values from 'lodash/values'\n\nimport { db, storage, Timestamp } from '@/lib/firebase'\n\nimport { DOCUMENT_TYPE } from '../components/Profile/Edit/utils'\n\n/**\n *  @enum {string} - firebase storage folder\n*/\nexport const STORAGE = {\n  EMPLOYEE_DOCUMENTS: 'employee_documents'\n}\n\n/**\n *  @enum {string} - firebase storage collection\n*/\nexport const COLLECTION = {\n  USERS: 'users'\n}\n\n// =================================================================================\n/**\n * Basic handler when userId is not defined as function param\n * @param {string} caller - function name\n * @returns {Promise}\n */\nfunction handleNoUserId (caller) {\n  return Promise.reject(new ReferenceError(`${caller}: id must be supplied'`))\n}\n\n/**\n * Get stored file metadata\n * @param {string} publicURL - public URL of stored file in Firebase Storage, the one that starts with https:// instead of gs://\n * @returns {Promise} a promise that resolves metadata in typeof object\n */\nexport function getStoredFileMetadata (publicURL) {\n  return storage.refFromURL(publicURL).getMetadata()\n}\n\n/**\n * Get user account data\n * @param {string|number} id - user id\n * @returns {object|null} user data if exists\n */\nexport function getUserById (id) {\n  if (!id) return handleNoUserId('getUserById')\n  return db\n    .collection(COLLECTION.USERS)\n    .doc(id)\n    .get()\n    .then(doc => {\n      if (doc.exists) {\n        return doc.data()\n      }\n      return null\n    })\n}\n\n/**\n * Insert or update user profile detail\n * @param {string|number} userId\n * @param {object} data\n * @returns {Promise}\n */\nexport function upsertUserProfileDetail (userId, data) {\n  if (!userId) return handleNoUserId(`updateUserPersonalData`)\n  if (!data) return Promise.resolve('noop')\n\n  return db\n    .collection(COLLECTION.USERS)\n    .doc(userId)\n    .update({\n      updated_at: Timestamp.now(),\n      ...data\n    })\n}\n\n/**\n * Insert or update user document to firebase storage\n * @param {string|number} userId\n * @param {string} documentType\n * @param {File} file\n * @param {Function} onProgress - a function that receives (progress: number, snapshot: UploadTask.snapshot) as arguments\n * @returns {Promise>} the resolved URL of stored file\n */\nexport function upsertUserDocument (userId, documentType, file, onProgress) {\n  if (!userId) return handleNoUserId('upsertUserDocument')\n  if (!file) return Promise.resolve('noop')\n\n  const allowedTypes = _values(DOCUMENT_TYPE)\n  const shouldProceed = allowedTypes.includes(documentType)\n  if (!shouldProceed) {\n    return Promise.reject(new ReferenceError(`upsertUserDocument: document type must be one of ${allowedTypes.join(', ')}`))\n  }\n\n  const ext = file.name.substring(file.name.lastIndexOf('.') + 1)\n  const storageRef = storage.ref().child(`${STORAGE.EMPLOYEE_DOCUMENTS}/${userId}/${documentType}-${userId}.${ext}`)\n  const uploadTask = storageRef.put(file)\n  if (typeof onProgress === 'function') {\n    uploadTask.on('state_changed', (snapshot) => {\n      const progress = Math.ceil((snapshot.bytesTransferred / snapshot.totalBytes) * 100)\n      onProgress(progress, snapshot)\n    })\n  }\n  return uploadTask\n    .then(snapshot => {\n      return snapshot.ref.getDownloadURL()\n    })\n}\n\nexport function deleteUserDocument (userId, filePublicURL) {\n  if (!userId) return handleNoUserId('deleteUserDocument')\n  if (!filePublicURL) return Promise.reject(new ReferenceError('deleteUserDocument: filePublicURL must be supplied'))\n\n  const storageRef = storage.refFromURL(filePublicURL)\n  return storageRef.delete()\n}\n"]}]}