{"remainingRequest":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/node_modules/babel-loader/lib/index.js!/Users/jds/Documents/diskominfo/jds/digiteam/groupware/node_modules/eslint-loader/index.js??ref--14-0!/Users/jds/Documents/diskominfo/jds/digiteam/groupware/src/lib/axios.js","dependencies":[{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/src/lib/axios.js","mtime":1673491775268},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/node_modules/cache-loader/dist/cjs.js","mtime":1673491971474},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/node_modules/babel-loader/lib/index.js","mtime":1673491971758},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/node_modules/eslint-loader/index.js","mtime":1673491969842}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCBfc2xpY2VkVG9BcnJheSBmcm9tICIvVXNlcnMvamRzL0RvY3VtZW50cy9kaXNrb21pbmZvL2pkcy9kaWdpdGVhbS9ncm91cHdhcmUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3NsaWNlZFRvQXJyYXkiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICIvVXNlcnMvamRzL0RvY3VtZW50cy9kaXNrb21pbmZvL2pkcy9kaWdpdGVhbS9ncm91cHdhcmUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnOwppbXBvcnQgeyBnZXRBeGlvc0NvbmZpZyB9IGZyb20gJy4uL2NvbmZpZyc7CmltcG9ydCB7IGdldFJlZnJlc2hUb2tlbkZyb21Db29raWUsIHNldFJlZnJlc2hUb2tlbkluQ29va2llLCBzZXRUb2tlbkluQ29va2llIH0gZnJvbSAnLi9qcy1jb29raWUnOwpleHBvcnQgdmFyIEdyb3Vwd2FyZUFQSSA9IGZ1bmN0aW9uICgpIHsKICB2YXIgY29uZmlnID0gZ2V0QXhpb3NDb25maWcoKTsKICByZXR1cm4gYXhpb3MuY3JlYXRlKGNvbmZpZyk7Cn0oKTsKZXhwb3J0IGZ1bmN0aW9uIHNldFRva2VuKHRva2VuKSB7CiAgaWYgKHRva2VuKSB7CiAgICBHcm91cHdhcmVBUEkuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ0F1dGhvcml6YXRpb24nXSA9ICJCZWFyZXIgIi5jb25jYXQodG9rZW4pOwogIH0gZWxzZSB7CiAgICBkZWxldGUgR3JvdXB3YXJlQVBJLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydBdXRob3JpemF0aW9uJ107CiAgfQp9CmV4cG9ydCBmdW5jdGlvbiBnZXROZXdUb2tlbigpIHsKICByZXR1cm4gX2dldE5ld1Rva2VuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmZ1bmN0aW9uIF9nZXROZXdUb2tlbigpIHsKICBfZ2V0TmV3VG9rZW4gPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgdmFyIG9sZFJlZnJlc2hUb2tlbiwgX3lpZWxkJEdyb3Vwd2FyZUFQSSRwLCBfeWllbGQkR3JvdXB3YXJlQVBJJHAyLCBuZXdSZWZyZXNoVG9rZW4sIG5ld0F1dGhUb2tlbjsKCiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDA7CiAgICAgICAgICAgIG9sZFJlZnJlc2hUb2tlbiA9IGdldFJlZnJlc2hUb2tlbkZyb21Db29raWUoKTsKCiAgICAgICAgICAgIGlmIChvbGRSZWZyZXNoVG9rZW4pIHsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignbm8gcmVmcmVzaCB0b2tlbiBpbiBjb29raWUnKTsKCiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNjsKICAgICAgICAgICAgcmV0dXJuIEdyb3Vwd2FyZUFQSS5wb3N0KCdhdXRoL3JlZnJlc2gvJywgewogICAgICAgICAgICAgIHJlZnJlc2h0b2tlbjogb2xkUmVmcmVzaFRva2VuCiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICAgIHJldHVybiByZXMuZGF0YTsKICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoX3JlZjIpIHsKICAgICAgICAgICAgICB2YXIgbmV3UmVmcmVzaFRva2VuID0gX3JlZjIucmVmcmVzaF90b2tlbiwKICAgICAgICAgICAgICAgICAgbmV3QXV0aFRva2VuID0gX3JlZjIuYXV0aF90b2tlbjsKCiAgICAgICAgICAgICAgaWYgKCFuZXdSZWZyZXNoVG9rZW4gfHwgIW5ld0F1dGhUb2tlbikgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdubyByZWZyZXNoIHRva2VuIGZyb20gQVBJJyk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzZXRSZWZyZXNoVG9rZW5JbkNvb2tpZShuZXdSZWZyZXNoVG9rZW4pOwogICAgICAgICAgICAgIHNldFRva2VuSW5Db29raWUobmV3QXV0aFRva2VuKTsKICAgICAgICAgICAgICBzZXRUb2tlbihuZXdBdXRoVG9rZW4pOwogICAgICAgICAgICAgIHJldHVybiBbbmV3UmVmcmVzaFRva2VuLCBuZXdBdXRoVG9rZW5dOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgIF95aWVsZCRHcm91cHdhcmVBUEkkcCA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICBfeWllbGQkR3JvdXB3YXJlQVBJJHAyID0gX3NsaWNlZFRvQXJyYXkoX3lpZWxkJEdyb3Vwd2FyZUFQSSRwLCAyKTsKICAgICAgICAgICAgbmV3UmVmcmVzaFRva2VuID0gX3lpZWxkJEdyb3Vwd2FyZUFQSSRwMlswXTsKICAgICAgICAgICAgbmV3QXV0aFRva2VuID0gX3lpZWxkJEdyb3Vwd2FyZUFQSSRwMlsxXTsKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICByZWZyZXNoVG9rZW46IG5ld1JlZnJlc2hUb2tlbiwKICAgICAgICAgICAgICBhdXRoVG9rZW46IG5ld0F1dGhUb2tlbgogICAgICAgICAgICB9KTsKCiAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDEzOwogICAgICAgICAgICBfY29udGV4dDIudDAgPSBfY29udGV4dDJbImNhdGNoIl0oMCk7CiAgICAgICAgICAgIHNldFJlZnJlc2hUb2tlbkluQ29va2llKG51bGwpOwogICAgICAgICAgICBzZXRUb2tlbkluQ29va2llKG51bGwpOwogICAgICAgICAgICBzZXRUb2tlbihudWxsKTsKICAgICAgICAgICAgdGhyb3cgX2NvbnRleHQyLnQwOwoKICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUyLCBudWxsLCBbWzAsIDEzXV0pOwogIH0pKTsKICByZXR1cm4gX2dldE5ld1Rva2VuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmV4cG9ydCBmdW5jdGlvbiB1c2VSZWZyZXNoVG9rZW5Ib29rKF9yZWYpIHsKICB2YXIgb25SZWZyZXNoU3VjY2VzcyA9IF9yZWYub25SZWZyZXNoU3VjY2VzcywKICAgICAgb25SZWZyZXNoRmFpbGVkID0gX3JlZi5vblJlZnJlc2hGYWlsZWQ7CiAgR3JvdXB3YXJlQVBJLmludGVyY2VwdG9ycy5yZXNwb25zZS51c2UoZnVuY3Rpb24gb25TdWNjZXNzKHJlcykgewogICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXMpOwogIH0sIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICB2YXIgX29uRXJyb3IgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoZXJyb3IpIHsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGlmICghKGVycm9yICYmIGVycm9yLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE3OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzZXRUb2tlbihudWxsKTsKICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMjsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNTsKICAgICAgICAgICAgICByZXR1cm4gZ2V0TmV3VG9rZW4oKTsKCiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBpZiAoISh0eXBlb2Ygb25SZWZyZXNoU3VjY2VzcyA9PT0gJ2Z1bmN0aW9uJykpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA4OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gODsKICAgICAgICAgICAgICByZXR1cm4gb25SZWZyZXNoU3VjY2VzcygpOwoKICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDEwOwogICAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oMik7CgogICAgICAgICAgICAgIGlmICghKHR5cGVvZiBvblJlZnJlc2hGYWlsZWQgPT09ICdmdW5jdGlvbicpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNTsKICAgICAgICAgICAgICByZXR1cm4gb25SZWZyZXNoRmFpbGVkKCk7CgogICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxODsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgUHJvbWlzZS5yZWplY3QoZXJyb3IpKTsKCiAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUsIG51bGwsIFtbMiwgMTBdXSk7CiAgICB9KSk7CgogICAgZnVuY3Rpb24gb25FcnJvcihfeCkgewogICAgICByZXR1cm4gX29uRXJyb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH0KCiAgICByZXR1cm4gb25FcnJvcjsKICB9KCkpOwp9"},{"version":3,"sources":["/Users/jds/Documents/diskominfo/jds/digiteam/groupware/src/lib/axios.js"],"names":["axios","getAxiosConfig","getRefreshTokenFromCookie","setRefreshTokenInCookie","setTokenInCookie","GroupwareAPI","config","create","setToken","token","defaults","headers","common","getNewToken","oldRefreshToken","Error","post","refreshtoken","then","res","data","newRefreshToken","refresh_token","newAuthToken","auth_token","refreshToken","authToken","useRefreshTokenHook","onRefreshSuccess","onRefreshFailed","interceptors","response","use","onSuccess","Promise","resolve","error","status","reject","onError"],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport { getAxiosConfig } from '../config'\n\nimport {\n  getRefreshTokenFromCookie,\n  setRefreshTokenInCookie,\n  setTokenInCookie\n} from './js-cookie'\n\nexport const GroupwareAPI = (function () {\n  const config = getAxiosConfig()\n  return axios.create(config)\n})()\n\nexport function setToken (token) {\n  if (token) {\n    GroupwareAPI.defaults.headers.common['Authorization'] = `Bearer ${token}`\n  } else {\n    delete GroupwareAPI.defaults.headers.common['Authorization']\n  }\n}\n\nexport async function getNewToken () {\n  try {\n    const oldRefreshToken = getRefreshTokenFromCookie()\n    if (!oldRefreshToken) {\n      throw new Error('no refresh token in cookie')\n    }\n    const [newRefreshToken, newAuthToken] = await GroupwareAPI\n      .post('auth/refresh/', {\n        refreshtoken: oldRefreshToken\n      })\n      .then((res) => res.data)\n      .then(({ refresh_token: newRefreshToken, auth_token: newAuthToken }) => {\n        if (!newRefreshToken || !newAuthToken) {\n          throw new Error('no refresh token from API')\n        }\n        setRefreshTokenInCookie(newRefreshToken)\n        setTokenInCookie(newAuthToken)\n        setToken(newAuthToken)\n        return [newRefreshToken, newAuthToken]\n      })\n    return {\n      refreshToken: newRefreshToken,\n      authToken: newAuthToken\n    }\n  } catch (e) {\n    setRefreshTokenInCookie(null)\n    setTokenInCookie(null)\n    setToken(null)\n    throw e\n  }\n}\n\nexport function useRefreshTokenHook ({\n  onRefreshSuccess,\n  onRefreshFailed\n}) {\n  GroupwareAPI.interceptors.response.use(\n    function onSuccess (res) {\n      return Promise.resolve(res)\n    },\n    async function onError (error) {\n      if (error && error.response.status === 401) {\n        setToken(null)\n        try {\n          await getNewToken()\n          if (typeof onRefreshSuccess === 'function') {\n            await onRefreshSuccess()\n          }\n        } catch (e) {\n          if (typeof onRefreshFailed === 'function') {\n            await onRefreshFailed()\n          }\n        }\n      } else {\n        return Promise.reject(error)\n      }\n    }\n  )\n}\n"]}]}