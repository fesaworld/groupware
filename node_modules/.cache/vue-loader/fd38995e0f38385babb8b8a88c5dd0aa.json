{"remainingRequest":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jds/Documents/diskominfo/jds/digiteam/groupware/src/components/Attendance/DayoffForm/form-submission.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/src/components/Attendance/DayoffForm/form-submission.vue","mtime":1673491775260},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/node_modules/cache-loader/dist/cjs.js","mtime":1673491971474},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/node_modules/babel-loader/lib/index.js","mtime":1673491971758},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/node_modules/cache-loader/dist/cjs.js","mtime":1673491971474},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/node_modules/vue-loader/lib/index.js","mtime":1673491936504}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBwTWluRGVsYXkgZnJvbSAncC1taW4tZGVsYXknCmltcG9ydCBtYXBLZXlzIGZyb20gJ2xvZGFzaC9tYXBLZXlzJwppbXBvcnQgc25ha2VDYXNlIGZyb20gJ2xvZGFzaC9zbmFrZUNhc2UnCmltcG9ydCB7IEdyb3Vwd2FyZUFQSSB9IGZyb20gJy4uLy4uLy4uL2xpYi9heGlvcycKaW1wb3J0IHsgZm9ybWF0RGF0ZUxvbmcgfSBmcm9tICcuLi8uLi8uLi9saWIvZGF0ZScKCmNvbnN0IFNUQVRVUyA9IHsKICBMT0FESU5HOiAnTE9BRElORycsCiAgU1VDQ0VTUzogJ1NVQ0NFU1MnLAogIEVSUk9SOiAnRVJST1InCn0KCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBBUElQb3N0RGF0YUxvYWRpbmdEaWFsb2c6ICgpID0+IGltcG9ydCgnLi4vLi4vQVBJUG9zdERhdGFMb2FkaW5nRGlhbG9nJykKICB9LAogIHByb3BzOiB7CiAgICBwYXlsb2FkOiB7CiAgICAgIHR5cGU6IE9iamVjdAogICAgfQogIH0sCiAgZGF0YSAoKSB7CiAgICByZXR1cm4gewogICAgICBpc0Zvcm1TdWJtaXR0ZWQ6IGZhbHNlLAogICAgICBmb3JtU3VibWlzc2lvblN0YXR1czogbnVsbCwKICAgICAgZm9ybVN1Ym1pc3Npb25FcnJvcjogbnVsbAogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC8vIGZvcm1hdCBwYXlsb2FkIGFzIHJlcXVpcmVkCiAgICBmb3JtYXR0ZWRQYXlsb2FkICgpIHsKICAgICAgLy8gcmVtb3ZlIGBpbWFnZUZpbGVgIGFuZCBgaW1hZ2VVUkxgIGZpZWxkcyBmcm9tIHBheWxvYWQKICAgICAgLy8gY29udmVydCBwZXJtaXRBY2tub3dsZWRnZWQgc3RyaW5nW10gdG8gc3RyaW5nIHdpdGggY29tbWEgZGVsaW1pdGVyCiAgICAgIGNvbnN0IHsgaW1hZ2VGaWxlLCBpbWFnZVVSTCwgcGVybWl0QWNrbm93bGVkZ2VkLCBzdGFydERhdGUsIGVuZERhdGUsIC4uLnJlc3QgfSA9IHRoaXMucGF5bG9hZAoKICAgICAgY29uc3QgcGF5bG9hZCA9IE9iamVjdC5hc3NpZ24oe30sIHJlc3QsIHsKICAgICAgICAvLyBhc3NpZ24gYGltYWdlRmlsZWAgdmFsdWUgdG8gYGZpbGVgIGZpZWxkCiAgICAgICAgZmlsZTogaW1hZ2VGaWxlLAogICAgICAgIHN0YXJ0RGF0ZTogc3RhcnREYXRlIGluc3RhbmNlb2YgRGF0ZSA/IHN0YXJ0RGF0ZS50b0lTT1N0cmluZygpIDogbnVsbCwKICAgICAgICBlbmREYXRlOiBlbmREYXRlIGluc3RhbmNlb2YgRGF0ZSA/IGVuZERhdGUudG9JU09TdHJpbmcoKSA6IG51bGwsCiAgICAgICAgcGVybWl0QWNrbm93bGVkZ2VkOiBBcnJheS5pc0FycmF5KHBlcm1pdEFja25vd2xlZGdlZCkgPyBwZXJtaXRBY2tub3dsZWRnZWQuam9pbignLCcpIDogbnVsbAogICAgICB9KQoKICAgICAgLy8gY29udmVydCB0byBzbmFrZWNhc2UKICAgICAgcmV0dXJuIG1hcEtleXMocGF5bG9hZCwgKHZhbHVlLCBrZXkpID0+IHNuYWtlQ2FzZShrZXkpKQogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgZm9ybWF0RGF0ZUxvbmcgKGRhdGUpIHsKICAgICAgcmV0dXJuIGRhdGUgPyBmb3JtYXREYXRlTG9uZyhkYXRlKSA6IG51bGwKICAgIH0sCgogICAgb25QcmV2aWV3SW1hZ2UgKCkgewogICAgICBpZiAod2luZG93ICYmIHRoaXMucGF5bG9hZC5pbWFnZVVSTCkgewogICAgICAgIHdpbmRvdy5vcGVuKHRoaXMucGF5bG9hZC5pbWFnZVVSTCwgJ19ibGFuaycpCiAgICAgIH0KICAgIH0sCgogICAgb25FZGl0RGF0YSAoKSB7CiAgICAgIHRoaXMuJGVtaXQoJ2NhbmNlbCcpCiAgICB9LAogICAgb25DbG9zZSAoKSB7CiAgICAgIGlmICh0aGlzLmlzRm9ybVN1Ym1pdHRlZCkgewogICAgICAgIHN3aXRjaCAodGhpcy5mb3JtU3VibWlzc2lvblN0YXR1cykgewogICAgICAgICAgY2FzZSBTVEFUVVMuU1VDQ0VTUzogcmV0dXJuIHRoaXMuJGVtaXQoJ3N1Y2Nlc3MnKQogICAgICAgICAgY2FzZSBTVEFUVVMuRVJST1I6IHJldHVybiB0aGlzLiRlbWl0KCdlcnJvcicsIHRoaXMuZm9ybVN1Ym1pc3Npb25FcnJvcikKICAgICAgICAgIGRlZmF1bHQ6IGJyZWFrCiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJGVtaXQoJ2Nsb3NlJykKICAgICAgfQogICAgfSwKICAgIGFzeW5jIG9uU3VibWl0ICgpIHsKICAgICAgdGhpcy5mb3JtU3VibWlzc2lvblN0YXR1cyA9IFNUQVRVUy5MT0FESU5HCiAgICAgIHRoaXMuZm9ybVN1Ym1pc3Npb25FcnJvciA9IG51bGwKICAgICAgdGhpcy5pc0Zvcm1TdWJtaXR0ZWQgPSB0cnVlCiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKQogICAgICAgIE9iamVjdC5lbnRyaWVzKHRoaXMuZm9ybWF0dGVkUGF5bG9hZCkuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7CiAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoa2V5LCB2YWx1ZSkKICAgICAgICB9KQogICAgICAgIGNvbnN0IHBvc3QgPSBHcm91cHdhcmVBUEkucG9zdCgnZGF5LW9mZi8nLCBmb3JtRGF0YSkKICAgICAgICBhd2FpdCBwTWluRGVsYXkocG9zdCwgMTUwMCkKICAgICAgICBhd2FpdCB0aGlzLm9uU3VibWl0U3VjY2VzcygpCiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBhd2FpdCB0aGlzLm9uU3VibWl0RXJyb3IoZSkKICAgICAgfQogICAgfSwKICAgIGFzeW5jIG9uU3VibWl0U3VjY2VzcyAoKSB7CiAgICAgIHRoaXMuZm9ybVN1Ym1pc3Npb25TdGF0dXMgPSBTVEFUVVMuU1VDQ0VTUwogICAgfSwKICAgIGFzeW5jIG9uU3VibWl0RXJyb3IgKGVycikgewogICAgICB0aGlzLmZvcm1TdWJtaXNzaW9uU3RhdHVzID0gU1RBVFVTLkVSUk9SCiAgICAgIGlmIChlcnIucmVzcG9uc2UpIHsKICAgICAgICB0aGlzLmZvcm1TdWJtaXNzaW9uRXJyb3IgPSBlcnIucmVzcG9uc2UuZGF0YS5tZXNzYWdlCiAgICAgIH0gZWxzZSBpZiAoZXJyIGluc3RhbmNlb2YgRXJyb3IpIHsKICAgICAgICB0aGlzLmZvcm1TdWJtaXNzaW9uRXJyb3IgPSBlcnIubWVzc2FnZQogICAgICB9CiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["form-submission.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6DA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"form-submission.vue","sourceRoot":"src/components/Attendance/DayoffForm","sourcesContent":["<template>\n  <div class=\"dayoff-confirmation\">\n    <template v-if=\"!isFormSubmitted\">\n      <div v-if=\"payload\" class=\"dayoff-confirmation__body\">\n        <h3 class=\"text-xl font-bold dark:text-gray-300\">\n          Konfirmasi Izin\n        </h3>\n        <p class=\"text-gray-800 dark:text-gray-300\">\n          Yuk cek lagi data izin kamu hari ini.\n        </p>\n        <strong class=\"text-green-600 text-lg leading-loose\">{{ payload.permitsType }}</strong>\n        <br />\n        <label class=\"text-gray-500\">Dari</label>\n        <p class=\"text-gray-800 dark:text-gray-300\">{{ formatDateLong(payload.startDate) }}</p>\n\n        <label class=\"text-gray-500\">Sampai</label>\n        <p class=\"text-gray-800 dark:text-gray-300\">{{ formatDateLong(payload.endDate) }}</p>\n\n        <label class=\"text-gray-500\">Sudah konfirmasi ke</label>\n        <p class=\"text-gray-800 dark:text-gray-300\">\n          <ul\n            v-if=\"payload.permitAcknowledged && payload.permitAcknowledged.length\"\n            class=\"list-decimal list-inside\">\n            <li v-for=\"(sh, index) in payload.permitAcknowledged\" :key=\"index\">\n              {{ sh }}\n            </li>\n          </ul>\n        </p>\n\n        <label class=\"text-gray-500\">Alasan</label>\n        <p class=\"text-gray-800 dark:text-gray-300\">{{ payload.note || '-' }}</p>\n\n        <label class=\"text-gray-500\">Evidence</label>\n        <img\n          alt=\"Dayoff Evidence\"\n          :src=\"payload.imageURL\"\n          class=\"dayoff-confirmation__evidence\"\n          @click=\"onPreviewImage\">\n      </div>\n      <div class=\"dayoff-confirmation__actions\">\n        <button class=\"dayoff-confirmation__btn btn-confirm\" @click=\"onSubmit\">\n          Sudah Benar\n        </button>\n        <button class=\"dayoff-confirmation__btn btn-cancel\" @click=\"onEditData\">\n          Edit Lagi\n        </button>\n      </div>\n    </template>\n    <template v-else>\n      <div class=\"dayoff-confirmation__body\">\n        <APIPostDataLoadingDialog v-if=\"isFormSubmitted\" :state=\"formSubmissionStatus\" @close=\"onClose\">\n          <template #message-error>\n            {{ formSubmissionError }}\n          </template>\n        </APIPostDataLoadingDialog>\n      </div>\n    </template>\n  </div>\n</template>\n\n<script>\nimport pMinDelay from 'p-min-delay'\nimport mapKeys from 'lodash/mapKeys'\nimport snakeCase from 'lodash/snakeCase'\nimport { GroupwareAPI } from '../../../lib/axios'\nimport { formatDateLong } from '../../../lib/date'\n\nconst STATUS = {\n  LOADING: 'LOADING',\n  SUCCESS: 'SUCCESS',\n  ERROR: 'ERROR'\n}\n\nexport default {\n  components: {\n    APIPostDataLoadingDialog: () => import('../../APIPostDataLoadingDialog')\n  },\n  props: {\n    payload: {\n      type: Object\n    }\n  },\n  data () {\n    return {\n      isFormSubmitted: false,\n      formSubmissionStatus: null,\n      formSubmissionError: null\n    }\n  },\n  computed: {\n    // format payload as required\n    formattedPayload () {\n      // remove `imageFile` and `imageURL` fields from payload\n      // convert permitAcknowledged string[] to string with comma delimiter\n      const { imageFile, imageURL, permitAcknowledged, startDate, endDate, ...rest } = this.payload\n\n      const payload = Object.assign({}, rest, {\n        // assign `imageFile` value to `file` field\n        file: imageFile,\n        startDate: startDate instanceof Date ? startDate.toISOString() : null,\n        endDate: endDate instanceof Date ? endDate.toISOString() : null,\n        permitAcknowledged: Array.isArray(permitAcknowledged) ? permitAcknowledged.join(',') : null\n      })\n\n      // convert to snakecase\n      return mapKeys(payload, (value, key) => snakeCase(key))\n    }\n  },\n  methods: {\n    formatDateLong (date) {\n      return date ? formatDateLong(date) : null\n    },\n\n    onPreviewImage () {\n      if (window && this.payload.imageURL) {\n        window.open(this.payload.imageURL, '_blank')\n      }\n    },\n\n    onEditData () {\n      this.$emit('cancel')\n    },\n    onClose () {\n      if (this.isFormSubmitted) {\n        switch (this.formSubmissionStatus) {\n          case STATUS.SUCCESS: return this.$emit('success')\n          case STATUS.ERROR: return this.$emit('error', this.formSubmissionError)\n          default: break\n        }\n      } else {\n        this.$emit('close')\n      }\n    },\n    async onSubmit () {\n      this.formSubmissionStatus = STATUS.LOADING\n      this.formSubmissionError = null\n      this.isFormSubmitted = true\n      try {\n        const formData = new FormData()\n        Object.entries(this.formattedPayload).forEach(([key, value]) => {\n          formData.append(key, value)\n        })\n        const post = GroupwareAPI.post('day-off/', formData)\n        await pMinDelay(post, 1500)\n        await this.onSubmitSuccess()\n      } catch (e) {\n        await this.onSubmitError(e)\n      }\n    },\n    async onSubmitSuccess () {\n      this.formSubmissionStatus = STATUS.SUCCESS\n    },\n    async onSubmitError (err) {\n      this.formSubmissionStatus = STATUS.ERROR\n      if (err.response) {\n        this.formSubmissionError = err.response.data.message\n      } else if (err instanceof Error) {\n        this.formSubmissionError = err.message\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.dayoff-confirmation {\n  @apply flex flex-col overflow-hidden max-h-full;\n\n  &__body {\n    @apply flex-1 p-4 overflow-y-auto;\n\n    > label {\n      @apply font-bold text-sm;\n    }\n\n    > p {\n      @apply mb-2 text-base;\n    }\n  }\n\n  &__actions {\n    display: grid;\n    grid-template-columns: repeat(1, 1fr);\n    gap: 1rem;\n    box-shadow: 0 -4px 16px 0 rgba(0,0,0,0.1);\n    @apply relative z-10\n    flex-none\n    mt-4 p-4;\n\n    @screen md {\n      grid-template-columns: repeat(2, 1fr);\n    }\n  }\n\n  &__evidence {\n    cursor: pointer;\n    max-width: 320px;\n    border: 1px solid #ddd;\n    @apply rounded-lg\n    object-contain object-center;\n\n    &:hover {\n      @apply opacity-50;\n    }\n  }\n\n  &__btn {\n    border-color: currentColor;\n    @apply px-4 py-2 rounded\n    border border-solid;\n\n    &.btn-confirm {\n      @apply bg-blue-600 text-white;\n    }\n\n    &.btn-cancel {\n      @apply bg-white text-blue-600;\n    }\n  }\n}\n\n.submit-status {\n  @apply text-center;\n\n  > img {\n    @apply mb-8 mx-auto;\n  }\n\n  &__text {\n    @apply text-xl font-bold;\n  }\n\n  &__btn-close {\n    @apply w-full mt-8 px-4 py-2 rounded-lg\n    border border-solid border-gray-600\n    bg-gray-100\n    text-gray-600;\n  }\n}\n</style>\n"]}]}