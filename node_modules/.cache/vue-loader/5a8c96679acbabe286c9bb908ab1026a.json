{"remainingRequest":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/src/components/Profile/Edit/ProfileSectionDetail.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/src/components/Profile/Edit/ProfileSectionDetail.vue","mtime":1673491775266},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/cache-loader/dist/cjs.js","mtime":1673491971474},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/babel-loader/lib/index.js","mtime":1673491971758},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/cache-loader/dist/cjs.js","mtime":1673491971474},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/vue-loader/lib/index.js","mtime":1673491936504}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBfY2xvbmVEZWVwIGZyb20gJ2xvZGFzaC9jbG9uZURlZXAnCmltcG9ydCBfZ2V0IGZyb20gJ2xvZGFzaC9nZXQnCmltcG9ydCBfc2V0IGZyb20gJ2xvZGFzaC9zZXQnCmltcG9ydCBfdW5zZXQgZnJvbSAnbG9kYXNoL3Vuc2V0JwppbXBvcnQgX2RlYm91bmNlIGZyb20gJ2xvZGFzaC9kZWJvdW5jZScKaW1wb3J0IF9pc01hdGNoIGZyb20gJ2xvZGFzaC9pc01hdGNoJwoKaW1wb3J0IERhdGFMb2FkZXIgZnJvbSAnLi4vLi4vRGF0YUxvYWRlcicKCmltcG9ydCB7IHVwc2VydFVzZXJEb2N1bWVudCwgZGVsZXRlVXNlckRvY3VtZW50LCB1cHNlcnRVc2VyUHJvZmlsZURldGFpbCB9IGZyb20gJy4uLy4uLy4uL2FwaScKaW1wb3J0IHsgUFJPRklMRV9ERVRBSUxfSVNfUFJJU1RJTkUgfSBmcm9tICcuLi8uLi8uLi9zdG9yZS9tdXRhdGlvbi10eXBlcycKaW1wb3J0IHsgRE9DVU1FTlRfTkFNRVNQQUNFLCBpbnZhbGlkRGF0YUFsZXJ0LCBzYXZpbmdBbGVydCwgc3VjY2Vzc0FsZXJ0LCBlcnJvckFsZXJ0IH0gZnJvbSAnLi91dGlscycKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBEYXRhTG9hZGVyCiAgfSwKICBwcm9wczogewogICAgbmFtZTogewogICAgICB0eXBlOiBTdHJpbmcKICAgIH0KICB9LAogIGRhdGEgKCkgewogICAgcmV0dXJuIHsKICAgICAgcHJvbWlzZWRVc2VyRGF0YTogbnVsbCwKICAgICAgZXhpc3RpbmdEYXRhOiB7fSwKICAgICAgZWRpdGVkRGF0YToge30KICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICBzZWN0aW9uQ29tcG9uZW50ICgpIHsKICAgICAgaWYgKHRoaXMubmFtZSkgewogICAgICAgIHJldHVybiAoKSA9PiBpbXBvcnQoYC4vJHt0aGlzLm5hbWUucmVwbGFjZSgnICcsICcnKX0udnVlYCkKICAgICAgfQogICAgICByZXR1cm4gbnVsbAogICAgfSwKICAgIHVzZXJJZCAoKSB7CiAgICAgIGNvbnN0IHsgdXNlciB9ID0gdGhpcy4kc3RvcmUuc3RhdGUuYXV0aAogICAgICByZXR1cm4gdXNlciA/IHVzZXIuaWQgOiBudWxsCiAgICB9LAogICAgaXNQcmlzdGluZTogewogICAgICBnZXQgKCkgewogICAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZVsncHJvZmlsZS1kZXRhaWwnXS5pc1ByaXN0aW5lCiAgICAgIH0sCiAgICAgIHNldCAodHJ1dGh5KSB7CiAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KGBwcm9maWxlLWRldGFpbC8ke1BST0ZJTEVfREVUQUlMX0lTX1BSSVNUSU5FfWAsICEhdHJ1dGh5KQogICAgICB9CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBhc3luYyBsb2FkVXNlckRhdGEgKCkgewogICAgICB0aGlzLnByb21pc2VkVXNlckRhdGEgPSBudWxsCiAgICAgIGlmICh0aGlzLnVzZXJJZCkgewogICAgICAgIHRoaXMucHJvbWlzZWRVc2VyRGF0YSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdwcm9maWxlLWRldGFpbC9mZXRjaEl0ZW0nLCB7CiAgICAgICAgICAgIGlkOiB0aGlzLnVzZXJJZCwKICAgICAgICAgICAgZnJlc2g6IGZhbHNlLAogICAgICAgICAgICBzaWxlbnQ6IHRydWUKICAgICAgICAgIH0pLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgICAgIHRoaXMuZXhpc3RpbmdEYXRhID0gZGF0YQogICAgICAgICAgICB0aGlzLmVkaXRlZERhdGEgPSBfY2xvbmVEZWVwKGRhdGEpCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgIHJlc29sdmUoKQogICAgICAgICAgICB9LCAyMDAwKQogICAgICAgICAgfSkKICAgICAgICB9KQogICAgICB9CiAgICAgIHJldHVybiB0aGlzLnByb21pc2VkVXNlckRhdGEKICAgIH0sCiAgICBvbkRhdGFDaGFuZ2VkIChlZGl0ZWREYXRhKSB7CiAgICAgIHRoaXMuZWRpdGVkRGF0YSA9IGVkaXRlZERhdGEKICAgIH0sCiAgICBhc3luYyBvblNhdmUgKHZhbGlkYXRlRm4pIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgdmFsaWRhdGVGbigpCiAgICAgICAgaWYgKCFpc1ZhbGlkKSB7CiAgICAgICAgICByZXR1cm4gaW52YWxpZERhdGFBbGVydCgpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNhdmluZ0FsZXJ0KCkKICAgICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlRmlsZXMoKQogICAgICAgICAgYXdhaXQgdGhpcy5oYW5kbGVEYXRhKCkKICAgICAgICAgIHRoaXMuaXNQcmlzdGluZSA9IHRydWUKICAgICAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdwcm9maWxlLWRldGFpbC9mZXRjaEl0ZW0nLCB7CiAgICAgICAgICAgIGlkOiB0aGlzLnVzZXJJZCwKICAgICAgICAgICAgZnJlc2g6IHRydWUsCiAgICAgICAgICAgIHNpbGVudDogdHJ1ZQogICAgICAgICAgfSkudGhlbihkYXRhID0+IHsKICAgICAgICAgICAgdGhpcy5leGlzdGluZ0RhdGEgPSBkYXRhCiAgICAgICAgICAgIHRoaXMuZWRpdGVkRGF0YSA9IF9jbG9uZURlZXAoZGF0YSkKICAgICAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgICAgICB0aGlzLmlzUHJpc3RpbmUgPSBmYWxzZQogICAgICAgICAgfSkKICAgICAgICAgIHJldHVybiBzdWNjZXNzQWxlcnQoKQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHJldHVybiBlcnJvckFsZXJ0KGUpCiAgICAgIH0KICAgIH0sCiAgICBhc3luYyBoYW5kbGVGaWxlcyAoKSB7CiAgICAgIGNvbnN0IG5hbWVzcGFjZXMgPSBPYmplY3QuZW50cmllcyhET0NVTUVOVF9OQU1FU1BBQ0UpCiAgICAgIHRyeSB7CiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lCiAgICAgICAgZm9yIChsZXQgW2RvY3VtZW50VHlwZSwgbnNdIG9mIG5hbWVzcGFjZXMpIHsKICAgICAgICAgIGNvbnN0IHNhdmVkVVJMID0gX2dldCh0aGlzLmV4aXN0aW5nRGF0YSwgbnMudXJsKQogICAgICAgICAgY29uc3QgbmV3VVJMID0gX2dldCh0aGlzLmVkaXRlZERhdGEsIG5zLnVybCkKICAgICAgICAgIGNvbnN0IG5ld0ZpbGUgPSBfZ2V0KHRoaXMuZWRpdGVkRGF0YSwgbnMuZmlsZSkKCiAgICAgICAgICBpZiAoc2F2ZWRVUkwgPT09IG5ld1VSTCkgewogICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgfSBlbHNlIGlmIChzYXZlZFVSTCAmJiAhbmV3VVJMKSB7CiAgICAgICAgICAgIGF3YWl0IGRlbGV0ZVVzZXJEb2N1bWVudChzYXZlZFVSTCkKICAgICAgICAgIH0gZWxzZSBpZiAobmV3RmlsZSkgewogICAgICAgICAgICBhd2FpdCB1cHNlcnRVc2VyRG9jdW1lbnQodGhpcy51c2VySWQsIGRvY3VtZW50VHlwZSwgbmV3RmlsZSkKICAgICAgICAgICAgICAudGhlbih1cmwgPT4gewogICAgICAgICAgICAgICAgX3Vuc2V0KHRoaXMuZWRpdGVkRGF0YSwgbnMuZmlsZSkKICAgICAgICAgICAgICAgIF9zZXQodGhpcy5lZGl0ZWREYXRhLCBucy51cmwsIHVybCkKICAgICAgICAgICAgICB9KQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlKQogICAgICB9CiAgICB9LAogICAgYXN5bmMgaGFuZGxlRGF0YSAoKSB7CiAgICAgIHJldHVybiB1cHNlcnRVc2VyUHJvZmlsZURldGFpbCh0aGlzLnVzZXJJZCwgdGhpcy5lZGl0ZWREYXRhKQogICAgfSwKICAgIGFzeW5jIG9uQ2FuY2VsICgpIHsKICAgICAgdGhpcy5lZGl0ZWREYXRhID0gX2Nsb25lRGVlcCh0aGlzLmV4aXN0aW5nRGF0YSkKICAgICAgcmV0dXJuIHRoaXMuJG5leHRUaWNrKCkKICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICB1c2VySWQ6IHsKICAgICAgaW1tZWRpYXRlOiB0cnVlLAogICAgICBoYW5kbGVyOiAnbG9hZFVzZXJEYXRhJwogICAgfSwKICAgIGVkaXRlZERhdGE6IHsKICAgICAgaW1tZWRpYXRlOiB0cnVlLAogICAgICBkZWVwOiB0cnVlLAogICAgICBoYW5kbGVyOiBfZGVib3VuY2UoZnVuY3Rpb24gKGVkaXRlZERhdGEpIHsKICAgICAgICB0aGlzLmlzUHJpc3RpbmUgPSBfaXNNYXRjaCh0aGlzLmV4aXN0aW5nRGF0YSwgZWRpdGVkRGF0YSkKICAgICAgfSwgMzAwKQogICAgfQogIH0KfQo="},{"version":3,"sources":["ProfileSectionDetail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4DA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ProfileSectionDetail.vue","sourceRoot":"src/components/Profile/Edit","sourcesContent":["<template>\n  <div>\n    <DataLoader :promise=\"promisedUserData\">\n      <template #pending>\n        <div class=\"w-full h-full flex justify-center items-center bg-gray-200\"\n             style=\"min-height: 200px;\">\n          <i aria-hidden=\"true\" class=\"app-logo is-rounded is-beating\"></i>\n        </div>\n      </template>\n      <template #error=\"{error}\">\n        <div class=\"w-full h-full flex flex-col justify-center items-center\">\n          <h5 class=\"text-2xl text-gray-500 font-bold\">Oops! Terjadi Kesalahan</h5>\n          <p class=\"text-red-500\">\n            <code>\n              {{error}}\n            </code>\n          </p>\n        </div>\n      </template>\n      <template #default>\n        <div>\n          <h3 class=\"px-4 py-8 sm:px-8 font-bold text-2xl text-white bg-brand-blue\">\n            <transition name=\"slide-y-fade-transition\"\n                        mode=\"out-in\">\n              <span :key=\"name\" :class=\"['profile-section-detail__title', !isPristine && 'has-unsaved-changes']\">\n                {{name}}\n              </span>\n            </transition>\n          </h3>\n          <ValidationObserver tag=\"div\" class=\"px-4 py-8 sm:px-8\" #default=\"{validate}\">\n            <transition name=\"slide-y-fade-transition\"\n                      mode=\"out-in\">\n              <div :key=\"name\">\n                <component ref=\"profileData\"\n                          :key=\"existingData.updated_at ? existingData.updated_at.seconds : existingData.created_at.seconds\"\n                          :is=\"sectionComponent\"\n                          :data=\"editedData\"\n                          @change:data=\"onDataChanged\"/>\n                <div class=\"flex flex-row justify-end items-center\">\n                  <button class=\"button bg-brand-green text-white mr-4\"\n                          :disabled=\"isPristine\"\n                          @click=\"onSave(validate)\">\n                    Simpan\n                  </button>\n                    <button class=\"button bg-gray-500 text-white\"\n                          :disabled=\"isPristine\"\n                          @click=\"onCancel\">\n                    Batal\n                  </button>\n                </div>\n              </div>\n            </transition>\n          </ValidationObserver>\n        </div>\n      </template>\n    </DataLoader>\n  </div>\n</template>\n\n<script>\nimport _cloneDeep from 'lodash/cloneDeep'\nimport _get from 'lodash/get'\nimport _set from 'lodash/set'\nimport _unset from 'lodash/unset'\nimport _debounce from 'lodash/debounce'\nimport _isMatch from 'lodash/isMatch'\n\nimport DataLoader from '../../DataLoader'\n\nimport { upsertUserDocument, deleteUserDocument, upsertUserProfileDetail } from '../../../api'\nimport { PROFILE_DETAIL_IS_PRISTINE } from '../../../store/mutation-types'\nimport { DOCUMENT_NAMESPACE, invalidDataAlert, savingAlert, successAlert, errorAlert } from './utils'\n\nexport default {\n  components: {\n    DataLoader\n  },\n  props: {\n    name: {\n      type: String\n    }\n  },\n  data () {\n    return {\n      promisedUserData: null,\n      existingData: {},\n      editedData: {}\n    }\n  },\n  computed: {\n    sectionComponent () {\n      if (this.name) {\n        return () => import(`./${this.name.replace(' ', '')}.vue`)\n      }\n      return null\n    },\n    userId () {\n      const { user } = this.$store.state.auth\n      return user ? user.id : null\n    },\n    isPristine: {\n      get () {\n        return this.$store.state['profile-detail'].isPristine\n      },\n      set (truthy) {\n        this.$store.commit(`profile-detail/${PROFILE_DETAIL_IS_PRISTINE}`, !!truthy)\n      }\n    }\n  },\n  methods: {\n    async loadUserData () {\n      this.promisedUserData = null\n      if (this.userId) {\n        this.promisedUserData = new Promise((resolve, reject) => {\n          this.$store.dispatch('profile-detail/fetchItem', {\n            id: this.userId,\n            fresh: false,\n            silent: true\n          }).then(data => {\n            this.existingData = data\n            this.editedData = _cloneDeep(data)\n            setTimeout(() => {\n              resolve()\n            }, 2000)\n          })\n        })\n      }\n      return this.promisedUserData\n    },\n    onDataChanged (editedData) {\n      this.editedData = editedData\n    },\n    async onSave (validateFn) {\n      try {\n        const isValid = await validateFn()\n        if (!isValid) {\n          return invalidDataAlert()\n        } else {\n          savingAlert()\n          await this.handleFiles()\n          await this.handleData()\n          this.isPristine = true\n          this.$store.dispatch('profile-detail/fetchItem', {\n            id: this.userId,\n            fresh: true,\n            silent: true\n          }).then(data => {\n            this.existingData = data\n            this.editedData = _cloneDeep(data)\n          }).catch(e => {\n            this.isPristine = false\n          })\n          return successAlert()\n        }\n      } catch (e) {\n        return errorAlert(e)\n      }\n    },\n    async handleFiles () {\n      const namespaces = Object.entries(DOCUMENT_NAMESPACE)\n      try {\n        // eslint-disable-next-line\n        for (let [documentType, ns] of namespaces) {\n          const savedURL = _get(this.existingData, ns.url)\n          const newURL = _get(this.editedData, ns.url)\n          const newFile = _get(this.editedData, ns.file)\n\n          if (savedURL === newURL) {\n            continue\n          } else if (savedURL && !newURL) {\n            await deleteUserDocument(savedURL)\n          } else if (newFile) {\n            await upsertUserDocument(this.userId, documentType, newFile)\n              .then(url => {\n                _unset(this.editedData, ns.file)\n                _set(this.editedData, ns.url, url)\n              })\n          }\n        }\n        return Promise.resolve()\n      } catch (e) {\n        return Promise.reject(e)\n      }\n    },\n    async handleData () {\n      return upsertUserProfileDetail(this.userId, this.editedData)\n    },\n    async onCancel () {\n      this.editedData = _cloneDeep(this.existingData)\n      return this.$nextTick()\n    }\n  },\n  watch: {\n    userId: {\n      immediate: true,\n      handler: 'loadUserData'\n    },\n    editedData: {\n      immediate: true,\n      deep: true,\n      handler: _debounce(function (editedData) {\n        this.isPristine = _isMatch(this.existingData, editedData)\n      }, 300)\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.profile-section-detail__title {\n  @apply relative;\n  &::after {\n    content: '';\n    transform: scale(0);\n    transform-origin: center;\n    left: calc(100% + #{0.5rem});\n    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n    @apply block absolute top-0 w-4 h-4 rounded-full bg-yellow-400;\n  }\n}\n.has-unsaved-changes {\n  &::after {\n    transform: scale(1);\n  }\n}\n</style>\n"]}]}