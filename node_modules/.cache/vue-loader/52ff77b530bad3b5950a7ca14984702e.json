{"remainingRequest":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/src/components/LazyListDataProvider.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/src/components/LazyListDataProvider.vue","mtime":1673491775264},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/cache-loader/dist/cjs.js","mtime":1673491971474},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/babel-loader/lib/index.js","mtime":1673491971758},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/cache-loader/dist/cjs.js","mtime":1673491971474},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/vue-loader/lib/index.js","mtime":1673491936504}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBtYWtlUHJvbWlzZUNhbmNlbGFibGUgZnJvbSAnLi4vbGliL2NhbmNlbGFibGUtcHJvbWlzZScKaW1wb3J0IHRocm90dGxlIGZyb20gJ2xvZGFzaC90aHJvdHRsZScKZXhwb3J0IGRlZmF1bHQgewogIHByb3BzOiB7CiAgICBpbW1lZGlhdGU6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCiAgICBkYXRhU291cmNlOiB7CiAgICAgIHR5cGU6IFtGdW5jdGlvbl0sCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICB9LAogICAgcGVyUGFnZTogewogICAgICB0eXBlOiBOdW1iZXIsCiAgICAgIGRlZmF1bHQ6IDUKICAgIH0KICB9LAogIGRhdGEgKCkgewogICAgcmV0dXJuIHsKICAgICAgaXNQZW5kaW5nOiBmYWxzZSwKICAgICAgZXJyb3I6IG51bGwsCiAgICAgIGRhdGE6IG51bGwsCiAgICAgIGN1cnJlbnRQYWdlOiAwLAogICAgICBoYXNOb01vcmVJdGVtc1RvRmV0Y2g6IGZhbHNlLAoKICAgICAgcHJvbWlzZUNhbmNlbFRva2VuOiBudWxsCiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgZGF0YVNvdXJjZUNvbnRleHQgKCkgewogICAgICByZXR1cm4gewogICAgICAgIGN1cnJlbnRQYWdlOiB0aGlzLmN1cnJlbnRQYWdlLAogICAgICAgIHBlclBhZ2U6IHRoaXMucGVyUGFnZSwKICAgICAgICBpbnRlcnNlY3Rpb25PYnNlcnZlcjogbnVsbAogICAgICB9CiAgICB9LAogICAgaGFzTm9EYXRhICgpIHsKICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFBhZ2UgPD0gMSAmJiAoIXRoaXMuZGF0YSB8fCAhdGhpcy5kYXRhLmxlbmd0aCkKICAgIH0sCiAgICBoYXNBdExlYXN0T25lRGF0YSAoKSB7CiAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQYWdlID49IDEgJiYgISF0aGlzLmRhdGEgJiYgISF0aGlzLmRhdGEubGVuZ3RoCiAgICB9CiAgfSwKICB3YXRjaDogewogICAgZGF0YVNvdXJjZUNvbnRleHQ6IHsKICAgICAgaW1tZWRpYXRlOiB0cnVlLAogICAgICBoYW5kbGVyIChjdHgpIHsKICAgICAgICB0aGlzLiRlbWl0KCdjaGFuZ2U6Y29udGV4dCcsIGN0eCkKICAgICAgfQogICAgfQogIH0sCiAgbW91bnRlZCAoKSB7CiAgICB0aGlzLiR3YXRjaCgKICAgICAgJ2ltbWVkaWF0ZScsCiAgICAgIGZ1bmN0aW9uIGhhbmRsZXIgKHRydXRoeSkgewogICAgICAgIGlmICh0cnV0aHkpIHsKICAgICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHRoaXMuc3RhcnRPYnNlcnZpbmcoKSkKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHsgaW1tZWRpYXRlOiB0cnVlIH0KICAgICkKICB9LAogIGJlZm9yZURlc3Ryb3kgKCkgewogICAgdGhpcy5zdG9wT2JzZXJ2aW5nKCkKICB9LAogIG1ldGhvZHM6IHsKICAgIHN0YXJ0T2JzZXJ2aW5nICgpIHsKICAgICAgdGhpcy5zdG9wT2JzZXJ2aW5nKCkKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgdGhpcy5jaGVja0ludGVyc2VjdGlvbk9ic2VydmVyU3VwcG9ydCgpCiAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgIHRoaXMudXNlSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoKQogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgIHRoaXMudXNlU2Nyb2xsTGlzdGVuZXIoKQogICAgICAgICAgfSkKICAgICAgfSwgNTApCiAgICB9LAogICAgc3RvcE9ic2VydmluZyAoKSB7CiAgICAgIHRoaXMuaW50ZXJzZWN0aW9uT2JzZXJ2ZXIgPSBudWxsCiAgICAgIHRoaXMucmVtb3ZlV2luZG93U2Nyb2xsTGlzdGVuZXIoKQogICAgfSwKICAgIGNoZWNrSW50ZXJzZWN0aW9uT2JzZXJ2ZXJTdXBwb3J0ICgpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICBpZiAoSW50ZXJzZWN0aW9uT2JzZXJ2ZXIpIHsKICAgICAgICAgIHJlc29sdmUoKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdpbnRlcnNlY3Rpb24gb2JzZXJ2ZXIgaXMgbm90IHN1cHBvcnRlZCcpKQogICAgICAgIH0KICAgICAgfSkKICAgIH0sCiAgICB1c2VJbnRlcnNlY3Rpb25PYnNlcnZlciAoKSB7CiAgICAgIHRoaXMuaW50ZXJzZWN0aW9uT2JzZXJ2ZXIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoCiAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25PYnNlcnZlckNhbGxiYWNrCiAgICAgICkKICAgICAgdGhpcy5pbnRlcnNlY3Rpb25PYnNlcnZlci5vYnNlcnZlKHRoaXMuJHJlZnMub2JzZXJ2ZXJUYXJnZXQpCiAgICB9LAogICAgaW50ZXJzZWN0aW9uT2JzZXJ2ZXJDYWxsYmFjayAoZW50cmllcykgewogICAgICBlbnRyaWVzLmZvckVhY2goKGVudHJ5KSA9PiB7CiAgICAgICAgaWYgKGVudHJ5LmlzSW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICB0aGlzLm9uRmV0Y2hEYXRhKCkKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgdXNlU2Nyb2xsTGlzdGVuZXIgKCkgewogICAgICB0aGlzLmdldE9ic2VydmVkVGFyZ2V0UG9zaXRpb24oKQogICAgICB0aGlzLmFkZFdpbmRvd1Njcm9sbExpc3RlbmVyKCkKICAgIH0sCiAgICBhZGRXaW5kb3dTY3JvbGxMaXN0ZW5lciAoKSB7CiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLmdldE9ic2VydmVkVGFyZ2V0UG9zaXRpb24sIHsKICAgICAgICBwYXNzaXZlOiB0cnVlCiAgICAgIH0pCiAgICB9LAogICAgcmVtb3ZlV2luZG93U2Nyb2xsTGlzdGVuZXIgKCkgewogICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgdGhpcy5nZXRPYnNlcnZlZFRhcmdldFBvc2l0aW9uLCB7CiAgICAgICAgcGFzc2l2ZTogdHJ1ZQogICAgICB9KQogICAgfSwKICAgIGdldE9ic2VydmVkVGFyZ2V0UG9zaXRpb246IHRocm90dGxlKGZ1bmN0aW9uICgpIHsKICAgICAgY29uc3QgZWwgPSB0aGlzLiRyZWZzLm9ic2VydmVyVGFyZ2V0CiAgICAgIGlmIChlbCkgewogICAgICAgIGNvbnN0IHJlY3QgPSBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKQogICAgICAgIGlmIChyZWN0LnRvcCA8PSB3aW5kb3cuaW5uZXJIZWlnaHQpIHsKICAgICAgICAgIHRoaXMub25GZXRjaERhdGEoKQogICAgICAgIH0KICAgICAgfQogICAgfSwgMTAwMCAvIDE0NCksCiAgICByZWZyZXNoICgpIHsKICAgICAgdGhpcy5pc1BlbmRpbmcgPSBmYWxzZQogICAgICB0aGlzLmhhc05vTW9yZUl0ZW1zVG9GZXRjaCA9IGZhbHNlCiAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSAwCiAgICAgIHRoaXMuZXJyb3IgPSBudWxsCiAgICAgIHRoaXMuZGF0YSA9IG51bGwKICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgIGlmICh0aGlzLnByb21pc2VDYW5jZWxUb2tlbikgewogICAgICAgICAgdGhpcy5wcm9taXNlQ2FuY2VsVG9rZW4uY2FuY2VsKCkKICAgICAgICB9CiAgICAgICAgdGhpcy5vbkZldGNoRGF0YSgpCiAgICAgIH0pCiAgICB9LAogICAgb25GZXRjaERhdGEgKCkgewogICAgICBpZiAodGhpcy5pc1BlbmRpbmcgfHwgdGhpcy5oYXNOb01vcmVJdGVtc1RvRmV0Y2gpIHsKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICB0aGlzLmN1cnJlbnRQYWdlICs9IDEKICAgICAgdGhpcy5pc1BlbmRpbmcgPSB0cnVlCiAgICAgIHRoaXMuZXJyb3IgPSBudWxsCiAgICAgIGxldCBwcm9taXNlCiAgICAgIGlmICh0eXBlb2YgdGhpcy5kYXRhU291cmNlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgO1twcm9taXNlLCB0aGlzLnByb21pc2VDYW5jZWxUb2tlbl0gPSBtYWtlUHJvbWlzZUNhbmNlbGFibGUoCiAgICAgICAgICB0aGlzLmRhdGFTb3VyY2UodGhpcy5kYXRhU291cmNlQ29udGV4dCkKICAgICAgICApCiAgICAgIH0KCiAgICAgIGlmICghcHJvbWlzZSB8fCAhcHJvbWlzZS50aGVuIHx8ICFwcm9taXNlLmNhdGNoIHx8ICFwcm9taXNlLmZpbmFsbHkpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKAogICAgICAgICAgJ0xhenlMaXN0RGF0YVByb3ZpZGVyOiBkYXRhU291cmNlIG11c3QgYmUgYW4gaW5zdGFuY2Ugb2YgUHJvbWlzZSBvciBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyBQcm9taXNlJwogICAgICAgICkKICAgICAgfQogICAgICByZXR1cm4gcHJvbWlzZQogICAgICAgIC50aGVuKChkYXRhKSA9PiB7CiAgICAgICAgICB0aGlzLmhhc05vTW9yZUl0ZW1zVG9GZXRjaCA9CiAgICAgICAgICAgICFkYXRhIHx8CiAgICAgICAgICAgICFkYXRhLmxlbmd0aCB8fAogICAgICAgICAgICAodGhpcy5jdXJyZW50UGFnZSA9PT0gMSAmJiBkYXRhLmxlbmd0aCA8IHRoaXMucGVyUGFnZSkKICAgICAgICAgIHRoaXMuZGF0YSA9IEFycmF5LmlzQXJyYXkodGhpcy5kYXRhKQogICAgICAgICAgICA/IFsuLi50aGlzLmRhdGEsIC4uLmRhdGFdCiAgICAgICAgICAgIDogWy4uLmRhdGFdCiAgICAgICAgICB0aGlzLnN0YXJ0T2JzZXJ2aW5nKCkKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgaWYgKGUgJiYgIWUuaXNDYW5jZWxlZCkgewogICAgICAgICAgICB0aGlzLmVycm9yID0gZQogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmZpbmFsbHkoKCkgPT4gewogICAgICAgICAgdGhpcy5pc1BlbmRpbmcgPSBmYWxzZQogICAgICAgIH0pCiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["LazyListDataProvider.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"LazyListDataProvider.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div>\n    <template v-if=\"data\">\n      <slot v-bind=\"{ data }\"></slot>\n    </template>\n    <template v-if=\"isPending\">\n      <slot name=\"pending\"></slot>\n    </template>\n    <template v-if=\"error\">\n      <slot\n        name=\"error\"\n        v-bind=\"{ message: error }\"\n      ></slot>\n    </template>\n    <template v-else-if=\"hasNoMoreItemsToFetch\">\n      <slot\n        name=\"end\"\n        v-bind=\"{ hasNoData, hasAtLeastOneData }\"\n      ></slot>\n    </template>\n    <div\n      role=\"observerTarget\"\n      ref=\"observerTarget\"\n      class=\"mb-16 h-0 bg-gray-200 rounded\"\n    ></div>\n  </div>\n</template>\n\n<script>\nimport makePromiseCancelable from '../lib/cancelable-promise'\nimport throttle from 'lodash/throttle'\nexport default {\n  props: {\n    immediate: {\n      type: Boolean,\n      default: false\n    },\n    dataSource: {\n      type: [Function],\n      required: true\n    },\n    perPage: {\n      type: Number,\n      default: 5\n    }\n  },\n  data () {\n    return {\n      isPending: false,\n      error: null,\n      data: null,\n      currentPage: 0,\n      hasNoMoreItemsToFetch: false,\n\n      promiseCancelToken: null\n    }\n  },\n  computed: {\n    dataSourceContext () {\n      return {\n        currentPage: this.currentPage,\n        perPage: this.perPage,\n        intersectionObserver: null\n      }\n    },\n    hasNoData () {\n      return this.currentPage <= 1 && (!this.data || !this.data.length)\n    },\n    hasAtLeastOneData () {\n      return this.currentPage >= 1 && !!this.data && !!this.data.length\n    }\n  },\n  watch: {\n    dataSourceContext: {\n      immediate: true,\n      handler (ctx) {\n        this.$emit('change:context', ctx)\n      }\n    }\n  },\n  mounted () {\n    this.$watch(\n      'immediate',\n      function handler (truthy) {\n        if (truthy) {\n          this.$nextTick(() => this.startObserving())\n        }\n      },\n      { immediate: true }\n    )\n  },\n  beforeDestroy () {\n    this.stopObserving()\n  },\n  methods: {\n    startObserving () {\n      this.stopObserving()\n      setTimeout(() => {\n        this.checkIntersectionObserverSupport()\n          .then(() => {\n            this.useIntersectionObserver()\n          })\n          .catch(() => {\n            this.useScrollListener()\n          })\n      }, 50)\n    },\n    stopObserving () {\n      this.intersectionObserver = null\n      this.removeWindowScrollListener()\n    },\n    checkIntersectionObserverSupport () {\n      return new Promise((resolve, reject) => {\n        if (IntersectionObserver) {\n          resolve()\n        } else {\n          reject(new Error('intersection observer is not supported'))\n        }\n      })\n    },\n    useIntersectionObserver () {\n      this.intersectionObserver = new IntersectionObserver(\n        this.intersectionObserverCallback\n      )\n      this.intersectionObserver.observe(this.$refs.observerTarget)\n    },\n    intersectionObserverCallback (entries) {\n      entries.forEach((entry) => {\n        if (entry.isIntersecting) {\n          this.onFetchData()\n        }\n      })\n    },\n    useScrollListener () {\n      this.getObservedTargetPosition()\n      this.addWindowScrollListener()\n    },\n    addWindowScrollListener () {\n      window.addEventListener('scroll', this.getObservedTargetPosition, {\n        passive: true\n      })\n    },\n    removeWindowScrollListener () {\n      window.removeEventListener('scroll', this.getObservedTargetPosition, {\n        passive: true\n      })\n    },\n    getObservedTargetPosition: throttle(function () {\n      const el = this.$refs.observerTarget\n      if (el) {\n        const rect = el.getBoundingClientRect()\n        if (rect.top <= window.innerHeight) {\n          this.onFetchData()\n        }\n      }\n    }, 1000 / 144),\n    refresh () {\n      this.isPending = false\n      this.hasNoMoreItemsToFetch = false\n      this.currentPage = 0\n      this.error = null\n      this.data = null\n      this.$nextTick(() => {\n        if (this.promiseCancelToken) {\n          this.promiseCancelToken.cancel()\n        }\n        this.onFetchData()\n      })\n    },\n    onFetchData () {\n      if (this.isPending || this.hasNoMoreItemsToFetch) {\n        return\n      }\n      this.currentPage += 1\n      this.isPending = true\n      this.error = null\n      let promise\n      if (typeof this.dataSource === 'function') {\n        ;[promise, this.promiseCancelToken] = makePromiseCancelable(\n          this.dataSource(this.dataSourceContext)\n        )\n      }\n\n      if (!promise || !promise.then || !promise.catch || !promise.finally) {\n        throw new TypeError(\n          'LazyListDataProvider: dataSource must be an instance of Promise or a function that returns Promise'\n        )\n      }\n      return promise\n        .then((data) => {\n          this.hasNoMoreItemsToFetch =\n            !data ||\n            !data.length ||\n            (this.currentPage === 1 && data.length < this.perPage)\n          this.data = Array.isArray(this.data)\n            ? [...this.data, ...data]\n            : [...data]\n          this.startObserving()\n        })\n        .catch((e) => {\n          if (e && !e.isCanceled) {\n            this.error = e\n          }\n        })\n        .finally(() => {\n          this.isPending = false\n        })\n    }\n  }\n}\n</script>\n"]}]}