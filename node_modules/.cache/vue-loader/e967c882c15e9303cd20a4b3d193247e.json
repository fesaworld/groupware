{"remainingRequest":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/src/components/Profile/Edit/ProfileSectionDetail.vue?vue&type=style&index=0&id=0d5b6c6c&lang=scss&scoped=true&","dependencies":[{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/src/components/Profile/Edit/ProfileSectionDetail.vue","mtime":1673491775266},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/css-loader/dist/cjs.js","mtime":1673491970692},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1673491936529},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/postcss-loader/src/index.js","mtime":1673491966590},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/sass-loader/dist/cjs.js","mtime":1673491959555},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/cache-loader/dist/cjs.js","mtime":1673491971474},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/vue-loader/lib/index.js","mtime":1673491936504}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoucHJvZmlsZS1zZWN0aW9uLWRldGFpbF9fdGl0bGUgewogIEBhcHBseSByZWxhdGl2ZTsKICAmOjphZnRlciB7CiAgICBjb250ZW50OiAnJzsKICAgIHRyYW5zZm9ybTogc2NhbGUoMCk7CiAgICB0cmFuc2Zvcm0tb3JpZ2luOiBjZW50ZXI7CiAgICBsZWZ0OiBjYWxjKDEwMCUgKyAjezAuNXJlbX0pOwogICAgdHJhbnNpdGlvbjogYWxsIDAuM3MgY3ViaWMtYmV6aWVyKDAuMTc1LCAwLjg4NSwgMC4zMiwgMS4yNzUpOwogICAgQGFwcGx5IGJsb2NrIGFic29sdXRlIHRvcC0wIHctNCBoLTQgcm91bmRlZC1mdWxsIGJnLXllbGxvdy00MDA7CiAgfQp9Ci5oYXMtdW5zYXZlZC1jaGFuZ2VzIHsKICAmOjphZnRlciB7CiAgICB0cmFuc2Zvcm06IHNjYWxlKDEpOwogIH0KfQo="},{"version":3,"sources":["ProfileSectionDetail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ProfileSectionDetail.vue","sourceRoot":"src/components/Profile/Edit","sourcesContent":["<template>\n  <div>\n    <DataLoader :promise=\"promisedUserData\">\n      <template #pending>\n        <div class=\"w-full h-full flex justify-center items-center bg-gray-200\"\n             style=\"min-height: 200px;\">\n          <i aria-hidden=\"true\" class=\"app-logo is-rounded is-beating\"></i>\n        </div>\n      </template>\n      <template #error=\"{error}\">\n        <div class=\"w-full h-full flex flex-col justify-center items-center\">\n          <h5 class=\"text-2xl text-gray-500 font-bold\">Oops! Terjadi Kesalahan</h5>\n          <p class=\"text-red-500\">\n            <code>\n              {{error}}\n            </code>\n          </p>\n        </div>\n      </template>\n      <template #default>\n        <div>\n          <h3 class=\"px-4 py-8 sm:px-8 font-bold text-2xl text-white bg-brand-blue\">\n            <transition name=\"slide-y-fade-transition\"\n                        mode=\"out-in\">\n              <span :key=\"name\" :class=\"['profile-section-detail__title', !isPristine && 'has-unsaved-changes']\">\n                {{name}}\n              </span>\n            </transition>\n          </h3>\n          <ValidationObserver tag=\"div\" class=\"px-4 py-8 sm:px-8\" #default=\"{validate}\">\n            <transition name=\"slide-y-fade-transition\"\n                      mode=\"out-in\">\n              <div :key=\"name\">\n                <component ref=\"profileData\"\n                          :key=\"existingData.updated_at ? existingData.updated_at.seconds : existingData.created_at.seconds\"\n                          :is=\"sectionComponent\"\n                          :data=\"editedData\"\n                          @change:data=\"onDataChanged\"/>\n                <div class=\"flex flex-row justify-end items-center\">\n                  <button class=\"button bg-brand-green text-white mr-4\"\n                          :disabled=\"isPristine\"\n                          @click=\"onSave(validate)\">\n                    Simpan\n                  </button>\n                    <button class=\"button bg-gray-500 text-white\"\n                          :disabled=\"isPristine\"\n                          @click=\"onCancel\">\n                    Batal\n                  </button>\n                </div>\n              </div>\n            </transition>\n          </ValidationObserver>\n        </div>\n      </template>\n    </DataLoader>\n  </div>\n</template>\n\n<script>\nimport _cloneDeep from 'lodash/cloneDeep'\nimport _get from 'lodash/get'\nimport _set from 'lodash/set'\nimport _unset from 'lodash/unset'\nimport _debounce from 'lodash/debounce'\nimport _isMatch from 'lodash/isMatch'\n\nimport DataLoader from '../../DataLoader'\n\nimport { upsertUserDocument, deleteUserDocument, upsertUserProfileDetail } from '../../../api'\nimport { PROFILE_DETAIL_IS_PRISTINE } from '../../../store/mutation-types'\nimport { DOCUMENT_NAMESPACE, invalidDataAlert, savingAlert, successAlert, errorAlert } from './utils'\n\nexport default {\n  components: {\n    DataLoader\n  },\n  props: {\n    name: {\n      type: String\n    }\n  },\n  data () {\n    return {\n      promisedUserData: null,\n      existingData: {},\n      editedData: {}\n    }\n  },\n  computed: {\n    sectionComponent () {\n      if (this.name) {\n        return () => import(`./${this.name.replace(' ', '')}.vue`)\n      }\n      return null\n    },\n    userId () {\n      const { user } = this.$store.state.auth\n      return user ? user.id : null\n    },\n    isPristine: {\n      get () {\n        return this.$store.state['profile-detail'].isPristine\n      },\n      set (truthy) {\n        this.$store.commit(`profile-detail/${PROFILE_DETAIL_IS_PRISTINE}`, !!truthy)\n      }\n    }\n  },\n  methods: {\n    async loadUserData () {\n      this.promisedUserData = null\n      if (this.userId) {\n        this.promisedUserData = new Promise((resolve, reject) => {\n          this.$store.dispatch('profile-detail/fetchItem', {\n            id: this.userId,\n            fresh: false,\n            silent: true\n          }).then(data => {\n            this.existingData = data\n            this.editedData = _cloneDeep(data)\n            setTimeout(() => {\n              resolve()\n            }, 2000)\n          })\n        })\n      }\n      return this.promisedUserData\n    },\n    onDataChanged (editedData) {\n      this.editedData = editedData\n    },\n    async onSave (validateFn) {\n      try {\n        const isValid = await validateFn()\n        if (!isValid) {\n          return invalidDataAlert()\n        } else {\n          savingAlert()\n          await this.handleFiles()\n          await this.handleData()\n          this.isPristine = true\n          this.$store.dispatch('profile-detail/fetchItem', {\n            id: this.userId,\n            fresh: true,\n            silent: true\n          }).then(data => {\n            this.existingData = data\n            this.editedData = _cloneDeep(data)\n          }).catch(e => {\n            this.isPristine = false\n          })\n          return successAlert()\n        }\n      } catch (e) {\n        return errorAlert(e)\n      }\n    },\n    async handleFiles () {\n      const namespaces = Object.entries(DOCUMENT_NAMESPACE)\n      try {\n        // eslint-disable-next-line\n        for (let [documentType, ns] of namespaces) {\n          const savedURL = _get(this.existingData, ns.url)\n          const newURL = _get(this.editedData, ns.url)\n          const newFile = _get(this.editedData, ns.file)\n\n          if (savedURL === newURL) {\n            continue\n          } else if (savedURL && !newURL) {\n            await deleteUserDocument(savedURL)\n          } else if (newFile) {\n            await upsertUserDocument(this.userId, documentType, newFile)\n              .then(url => {\n                _unset(this.editedData, ns.file)\n                _set(this.editedData, ns.url, url)\n              })\n          }\n        }\n        return Promise.resolve()\n      } catch (e) {\n        return Promise.reject(e)\n      }\n    },\n    async handleData () {\n      return upsertUserProfileDetail(this.userId, this.editedData)\n    },\n    async onCancel () {\n      this.editedData = _cloneDeep(this.existingData)\n      return this.$nextTick()\n    }\n  },\n  watch: {\n    userId: {\n      immediate: true,\n      handler: 'loadUserData'\n    },\n    editedData: {\n      immediate: true,\n      deep: true,\n      handler: _debounce(function (editedData) {\n        this.isPristine = _isMatch(this.existingData, editedData)\n      }, 300)\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.profile-section-detail__title {\n  @apply relative;\n  &::after {\n    content: '';\n    transform: scale(0);\n    transform-origin: center;\n    left: calc(100% + #{0.5rem});\n    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n    @apply block absolute top-0 w-4 h-4 rounded-full bg-yellow-400;\n  }\n}\n.has-unsaved-changes {\n  &::after {\n    transform: scale(1);\n  }\n}\n</style>\n"]}]}