{"remainingRequest":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/src/components/Form/InputFile.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/src/components/Form/InputFile.vue","mtime":1673491775263},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/cache-loader/dist/cjs.js","mtime":1673491971474},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/babel-loader/lib/index.js","mtime":1673491971758},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/cache-loader/dist/cjs.js","mtime":1673491971474},{"path":"/Users/jds/Documents/diskominfo/jds/digiteam/groupware/groupware/node_modules/vue-loader/lib/index.js","mtime":1673491936504}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IENvbnRlbnRMb2FkZXIgfSBmcm9tICd2dWUtY29udGVudC1sb2FkZXInCmltcG9ydCB7IGdldFN0b3JlZEZpbGVNZXRhZGF0YSB9IGZyb20gJy4uLy4uL2FwaScKaW1wb3J0IHsgcHJvcHMsIGNvbXBvbmVudHMgfSBmcm9tICcuL2lucHV0LW1peGluJwoKY29uc3QgU1RPUkFHRSA9IHsKICBGSVJFQkFTRTogJ2ZpcmViYXNlJywKICBHUk9VUFdBUkVfU0VSVklDRTogJ2dyb3Vwd2FyZS1zZXJ2aWNlJwp9CgpleHBvcnQgZGVmYXVsdCB7CiAgaW5oZXJpdEF0dHJzOiBmYWxzZSwKICBjb21wb25lbnRzOiB7CiAgICAuLi5jb21wb25lbnRzLAogICAgQ29udGVudExvYWRlciwKICAgIERhdGFMb2FkZXI6ICgpID0+IGltcG9ydCgnLi4vRGF0YUxvYWRlcicpLAogICAgRmlsZVByZXZpZXc6ICgpID0+IGltcG9ydCgnLi9GaWxlUHJldmlldycpCiAgfSwKICBwcm9wczogewogICAgLi4ucHJvcHMsCiAgICB2YWx1ZTogewogICAgICB0eXBlOiBTdHJpbmcKICAgIH0sCiAgICBmaWxlOiB7CiAgICAgIHR5cGU6IEZpbGUKICAgIH0sCiAgICBmaWxlbmFtZTogewogICAgICB0eXBlOiBTdHJpbmcKICAgIH0sCiAgICBzb3VyY2U6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiBTVE9SQUdFLkZJUkVCQVNFLAogICAgICB2YWxpZGF0b3IgKHYpIHsKICAgICAgICByZXR1cm4gW1NUT1JBR0UuRklSRUJBU0UsIFNUT1JBR0UuR1JPVVBXQVJFX1NFUlZJQ0VdLmluY2x1ZGVzKHYpCiAgICAgIH0KICAgIH0sCiAgICByZW5hbWVhYmxlOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IHRydWUKICAgIH0sCiAgICBkb3dubG9hZE9uQ2xpY2s6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0KICB9LAogIGRhdGEgKCkgewogICAgcmV0dXJuIHsKICAgICAgbUZpbGU6IG51bGwsCiAgICAgIG1GaWxlVVJMOiBudWxsLAoKICAgICAgcHJvbWlzZWRNZXRhZGF0YTogbnVsbAogICAgfQogIH0sCiAgbW91bnRlZCAoKSB7CiAgICB0aGlzLiRuZXh0VGljaygpCiAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICB0aGlzLiR3YXRjaCgKICAgICAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIFt0aGlzLnZhbHVlLCB0aGlzLmZpbGVdCiAgICAgICAgICB9LAogICAgICAgICAgZnVuY3Rpb24gKGFycikgewogICAgICAgICAgICBjb25zdCBbdmFsdWUsIGZpbGVdID0gYXJyCiAgICAgICAgICAgIHRoaXMuJHJlZnMudmFsaWRhdG9yLnN5bmNWYWx1ZSh2YWx1ZSkKICAgICAgICAgICAgdGhpcy5tRmlsZVVSTCA9IHZhbHVlCiAgICAgICAgICAgIHRoaXMubUZpbGUgPSBmaWxlCiAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpcy5tRmlsZVVSTCA9PT0gJ3N0cmluZycgJiYgdGhpcy5tRmlsZVVSTC5zdGFydHNXaXRoKCdodHRwJykpIHsKICAgICAgICAgICAgICB0aGlzLnByb21pc2VkTWV0YWRhdGEgPSB0aGlzLmdldEZpbGVNZXRhZGF0YSh0aGlzLm1GaWxlVVJMKQogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMubUZpbGUgaW5zdGFuY2VvZiBGaWxlKSB7CiAgICAgICAgICAgICAgdGhpcy5wcm9taXNlZE1ldGFkYXRhID0gbmV3IFByb21pc2UocmVzb2x2ZSA9PiByZXNvbHZlKHRoaXMubUZpbGUpKQogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgeyBpbW1lZGlhdGU6IHRydWUsIGRlZXA6IHRydWUgfQogICAgICAgICkKICAgICAgfSkKICB9LAogIGNvbXB1dGVkOiB7CiAgICBzaG91bGREaXNhYmxlVmFsaWRhdGlvbiAoKSB7CiAgICAgIHJldHVybiB0eXBlb2YgdGhpcy52YWx1ZSA9PT0gJ3N0cmluZycgJiYgWydibG9iJywgJ2h0dHAnXS5zb21lKHN0ciA9PiB0aGlzLnZhbHVlLnN0YXJ0c1dpdGgoc3RyKSkKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGdldEZpbGVNZXRhZGF0YSAodXJsKSB7CiAgICAgIGlmICh0aGlzLnNvdXJjZSA9PT0gU1RPUkFHRS5GSVJFQkFTRSkgewogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgICBnZXRTdG9yZWRGaWxlTWV0YWRhdGEodXJsKQogICAgICAgICAgICAudGhlbigobWV0YWRhdGEgPSB7fSkgPT4gewogICAgICAgICAgICAgIHJlc29sdmUoewogICAgICAgICAgICAgICAgbmFtZTogbWV0YWRhdGEubmFtZSwKICAgICAgICAgICAgICAgIHR5cGU6IG1ldGFkYXRhLmNvbnRlbnRUeXBlLAogICAgICAgICAgICAgICAgc2l6ZTogbWV0YWRhdGEuc2l6ZQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaChlID0+IHsKICAgICAgICAgICAgICByZWplY3QoZSkKICAgICAgICAgICAgfSkKICAgICAgICB9KQogICAgICB9CiAgICAgIGlmICh0aGlzLnNvdXJjZSA9PT0gU1RPUkFHRS5HUk9VUFdBUkVfU0VSVklDRSkgewogICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe30pCiAgICAgIH0KICAgIH0sCiAgICByZXNldElucHV0RWxlbWVudCAoKSB7CiAgICAgIGlmICh0aGlzLiRyZWZzLmlucHV0KSB7CiAgICAgICAgdGhpcy4kcmVmcy5pbnB1dC50eXBlID0gJycKICAgICAgICB0aGlzLiRyZWZzLmlucHV0LnNldEF0dHJpYnV0ZSgndHlwZScsICcnKQogICAgICAgIHJldHVybiB0aGlzLiRuZXh0VGljaygpCiAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgIHRoaXMuJHJlZnMuaW5wdXQudHlwZSA9ICdmaWxlJwogICAgICAgICAgICB0aGlzLiRyZWZzLmlucHV0LnNldEF0dHJpYnV0ZSgndHlwZScsICdmaWxlJykKICAgICAgICAgIH0pCiAgICAgIH0KICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpCiAgICB9LAogICAgb25DaG9vc2VGaWxlICgpIHsKICAgICAgdGhpcy5tRmlsZSA9IG51bGwKICAgICAgdGhpcy5tRmlsZVVSTCA9IG51bGwKICAgICAgdGhpcy5yZXNldElucHV0RWxlbWVudCgpCiAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgdGhpcy4kcmVmcy5pbnB1dC5jbGljaygpCiAgICAgICAgfSkKICAgIH0sCiAgICBvblJlbW92ZUZpbGUgKCkgewogICAgICB0aGlzLnByb21pc2VkTWV0YWRhdGEgPSBudWxsCiAgICAgIHRoaXMucmVzZXRJbnB1dEVsZW1lbnQoKQogICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgIHRoaXMubUZpbGUgPSBudWxsCiAgICAgICAgICB0aGlzLm1GaWxlVVJMID0gbnVsbAogICAgICAgICAgdGhpcy5lbWl0Q2hhbmdlKG51bGwsIG51bGwsIG51bGwpCiAgICAgICAgICByZXR1cm4gdGhpcy4kbmV4dFRpY2soKQogICAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgICAgdGhpcy4kcmVmcy52YWxpZGF0b3IudmFsaWRhdGUoKQogICAgICAgIH0pCiAgICB9LAogICAgb25GaWxlbmFtZUNoYW5nZWQgKG5hbWUpIHsKICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOmZpbGVuYW1lJywgbmFtZSkKICAgIH0sCiAgICBvbkNoYW5nZSAoZSkgewogICAgICBpZiAoZS50YXJnZXQuZmlsZXMpIHsKICAgICAgICB0aGlzLm1GaWxlID0gZS50YXJnZXQuZmlsZXMubGVuZ3RoID8gZS50YXJnZXQuZmlsZXNbMF0gOiBudWxsCiAgICAgICAgdGhpcy5tRmlsZVVSTCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKHRoaXMubUZpbGUpCiAgICAgICAgdGhpcy5lbWl0Q2hhbmdlKHRoaXMubUZpbGVVUkwsIHRoaXMubUZpbGUubmFtZSwgdGhpcy5tRmlsZSkKICAgICAgfQogICAgICB0aGlzLiRuZXh0VGljaygpCiAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgdGhpcy4kcmVmcy52YWxpZGF0b3IudmFsaWRhdGUoZSkKICAgICAgICB9KQogICAgfSwKICAgIGVtaXRDaGFuZ2UgKHVybCwgZmlsZW5hbWUsIGZpbGUpIHsKICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOnZhbHVlJywgdXJsKQogICAgICB0aGlzLiRlbWl0KCd1cGRhdGU6ZmlsZW5hbWUnLCBmaWxlbmFtZSkKICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOmZpbGUnLCBmaWxlKQogICAgfSwKICAgIG9uUHJldmlld0RvY3VtZW50ICgpIHsKICAgICAgdGhpcy5tRmlsZVVSTCAmJiB3aW5kb3cub3Blbih0aGlzLm1GaWxlVVJMLCAnX2JsYW5rJykKICAgIH0KICB9Cn0K"},{"version":3,"sources":["InputFile.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+EA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"InputFile.vue","sourceRoot":"src/components/Form","sourcesContent":["<template>\n  <ValidationProvider :rules=\"rules\"\n                      :disabled=\"shouldDisableValidation\"\n                      :custom-messages=\"customMessages\"\n                      #default=\"{failed, errors}\"\n                      tag=\"div\"\n                      ref=\"validator\">\n    <FormInputHeader :label-for=\"name\"\n                      :title=\"title\"\n                      :subtitle=\"subtitle\"\n                      :required=\"required\">\n      <template #title>\n        <slot name=\"title\"></slot>\n      </template>\n      <template #subtitle>\n        <slot name=\"subtitle\"></slot>\n      </template>\n    </FormInputHeader>\n    <DataLoader v-if=\"promisedMetadata\"\n                :promise=\"promisedMetadata\">\n      <template #pending>\n        <ContentLoader  class=\"max-w-xs\"\n                        :width=\"320\"\n                        :height=\"128\"\n                        :speed=\"2\"\n                        primary-color=\"#eceff1\"\n                        secondary-color=\"#fafafa\">\n          <rect x=\"0\" y=\"0\" rx=\"8\" ry=\"8\" width=\"128\" height=\"128\"></rect>\n          <rect x=\"144\" y=\"0\" rx=\"8\" ry=\"8\" width=\"100\" height=\"16\"></rect>\n          <rect x=\"144\" y=\"32\" rx=\"8\" ry=\"8\" width=\"176\" height=\"16\"></rect>\n          <rect x=\"144\" y=\"64\" rx=\"8\" ry=\"8\" width=\"176\" height=\"16\"></rect>\n          <rect x=\"144\" y=\"96\" rx=\"8\" ry=\"8\" width=\"64\" height=\"16\"></rect>\n        </ContentLoader>\n      </template>\n      <template #default=\"{value: metadata}\">\n        <FilePreview  v-if=\"metadata\"\n                      :file=\"file\"\n                      :name=\"filename\"\n                      :size=\"metadata.size\"\n                      :type=\"metadata.type\"\n                      :url=\"mFileURL\"\n                      :disabled=\"disabled\"\n                      :renameable=\"renameable\"\n                      :download-on-click=\"downloadOnClick\"\n                      @view=\"onPreviewDocument\"\n                      @update:name=\"onFilenameChanged\"\n                      @delete=\"onRemoveFile\"/>\n      </template>\n    </DataLoader>\n    <template v-else>\n      <div :class=\"{'form-input__file mb-2': true, 'is-invalid': failed}\">\n        <button @click=\"onChooseFile\">\n          Pilih\n        </button>\n        <a :href=\"mFileURL || false\"\n            target=\"_blank\"\n            @click.prevent=\"onPreviewDocument\">\n          {{(mFile && mFile.name) || mFileURL || $attrs.placeholder }}\n        </a>\n      </div>\n      <input v-show=\"false\"\n            ref=\"input\"\n            :name=\"name\"\n            :rules=\"rules\"\n            type=\"file\"\n            :multiple=\"false\"\n            v-bind=\"$attrs\"\n            @change=\"onChange($event)\">\n    </template>\n    <p v-if=\"errors.length\"\n       class=\"form-input__error-hint\">\n      <slot name=\"error\">\n        {{errors[0]}}\n      </slot>\n    </p>\n  </ValidationProvider>\n</template>\n\n<script>\nimport { ContentLoader } from 'vue-content-loader'\nimport { getStoredFileMetadata } from '../../api'\nimport { props, components } from './input-mixin'\n\nconst STORAGE = {\n  FIREBASE: 'firebase',\n  GROUPWARE_SERVICE: 'groupware-service'\n}\n\nexport default {\n  inheritAttrs: false,\n  components: {\n    ...components,\n    ContentLoader,\n    DataLoader: () => import('../DataLoader'),\n    FilePreview: () => import('./FilePreview')\n  },\n  props: {\n    ...props,\n    value: {\n      type: String\n    },\n    file: {\n      type: File\n    },\n    filename: {\n      type: String\n    },\n    source: {\n      type: String,\n      default: STORAGE.FIREBASE,\n      validator (v) {\n        return [STORAGE.FIREBASE, STORAGE.GROUPWARE_SERVICE].includes(v)\n      }\n    },\n    renameable: {\n      type: Boolean,\n      default: true\n    },\n    downloadOnClick: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data () {\n    return {\n      mFile: null,\n      mFileURL: null,\n\n      promisedMetadata: null\n    }\n  },\n  mounted () {\n    this.$nextTick()\n      .then(() => {\n        this.$watch(\n          function () {\n            return [this.value, this.file]\n          },\n          function (arr) {\n            const [value, file] = arr\n            this.$refs.validator.syncValue(value)\n            this.mFileURL = value\n            this.mFile = file\n            if (typeof this.mFileURL === 'string' && this.mFileURL.startsWith('http')) {\n              this.promisedMetadata = this.getFileMetadata(this.mFileURL)\n            } else if (this.mFile instanceof File) {\n              this.promisedMetadata = new Promise(resolve => resolve(this.mFile))\n            }\n          },\n          { immediate: true, deep: true }\n        )\n      })\n  },\n  computed: {\n    shouldDisableValidation () {\n      return typeof this.value === 'string' && ['blob', 'http'].some(str => this.value.startsWith(str))\n    }\n  },\n  methods: {\n    getFileMetadata (url) {\n      if (this.source === STORAGE.FIREBASE) {\n        return new Promise((resolve, reject) => {\n          getStoredFileMetadata(url)\n            .then((metadata = {}) => {\n              resolve({\n                name: metadata.name,\n                type: metadata.contentType,\n                size: metadata.size\n              })\n            })\n            .catch(e => {\n              reject(e)\n            })\n        })\n      }\n      if (this.source === STORAGE.GROUPWARE_SERVICE) {\n        return Promise.resolve({})\n      }\n    },\n    resetInputElement () {\n      if (this.$refs.input) {\n        this.$refs.input.type = ''\n        this.$refs.input.setAttribute('type', '')\n        return this.$nextTick()\n          .then(() => {\n            this.$refs.input.type = 'file'\n            this.$refs.input.setAttribute('type', 'file')\n          })\n      }\n      return Promise.resolve()\n    },\n    onChooseFile () {\n      this.mFile = null\n      this.mFileURL = null\n      this.resetInputElement()\n        .then(() => {\n          this.$refs.input.click()\n        })\n    },\n    onRemoveFile () {\n      this.promisedMetadata = null\n      this.resetInputElement()\n        .then(() => {\n          this.mFile = null\n          this.mFileURL = null\n          this.emitChange(null, null, null)\n          return this.$nextTick()\n        }).then(() => {\n          this.$refs.validator.validate()\n        })\n    },\n    onFilenameChanged (name) {\n      this.$emit('update:filename', name)\n    },\n    onChange (e) {\n      if (e.target.files) {\n        this.mFile = e.target.files.length ? e.target.files[0] : null\n        this.mFileURL = window.URL.createObjectURL(this.mFile)\n        this.emitChange(this.mFileURL, this.mFile.name, this.mFile)\n      }\n      this.$nextTick()\n        .then(() => {\n          this.$refs.validator.validate(e)\n        })\n    },\n    emitChange (url, filename, file) {\n      this.$emit('update:value', url)\n      this.$emit('update:filename', filename)\n      this.$emit('update:file', file)\n    },\n    onPreviewDocument () {\n      this.mFileURL && window.open(this.mFileURL, '_blank')\n    }\n  }\n}\n</script>\n"]}]}